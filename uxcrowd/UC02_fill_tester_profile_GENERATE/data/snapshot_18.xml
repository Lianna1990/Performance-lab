<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="18">
  <HTTPTask id="266" hostname="prod.uxcrowd.ru" path="/assets/js/main_js/init.js" url="https://prod.uxcrowd.ru/assets/js/main_js/init.js" ip="127.0.0.1" port="443" connectionId="7" origin="Primary" frame="1" startDateTime="2019-10-18T15:08:50.098+03:00" startTime="80862031" endTime="80862140">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHJvZC51eGNyb3dkLnJ1</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQ7IHJ2OjQ4LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvNDguMA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cnUtUlUscnU7cT0wLjgsZW4tVVM7cT0wLjUsZW47cT0wLjM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly9wcm9kLnV4Y3Jvd2QucnUv</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9hc3NldHMvanMvbWFpbl9qcy9pbml0LmpzIEhUVFAvMS4xDQpIb3N0OiBwcm9kLnV4Y3Jvd2QucnUNClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdPVzY0OyBydjo0OC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzQ4LjANCkFjY2VwdDogKi8qDQpBY2NlcHQtTGFuZ3VhZ2U6IHJ1LVJVLHJ1O3E9MC44LGVuLVVTO3E9MC41LGVuO3E9MC4zDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUsIGJyDQpSZWZlcmVyOiBodHRwczovL3Byb2QudXhjcm93ZC5ydS8NCkNvbm5lY3Rpb246IGtlZXAtYWxpdmUNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>87478</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bmdpbng=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxOCBPY3QgMjAxOSAxMjowNzoxOCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDsgY2hhcnNldD1VVEYtOA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ODc0Nzg=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>V2VkLCAyNSBTZXAgMjAxOSAxNToyMTowNiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjVkOGI4NWUyLTE1NWI2Ig==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bXVzdC1yZXZhbGlkYXRl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Security-Policy-Report-Only" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZGVmYXVsdC1zcmMgaHR0cHM6OyBzY3JpcHQtc3JjIGh0dHBzOiAndW5zYWZlLWV2YWwnICd1bnNhZmUtaW5saW5lJzsgc3R5bGUtc3JjIGh0dHBzOiAndW5zYWZlLWlubGluZSc7IGltZy1zcmMgaHR0cHM6IGRhdGE6OyBmb250LXNyYyBodHRwczogZGF0YTo7IHJlcG9ydC11cmkgL2NzcC1yZXBvcnQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Strict-Transport-Security" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT04NjQwMDs=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Security-Policy-Report-Only" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZGVmYXVsdC1zcmMgaHR0cHM6OyBzY3JpcHQtc3JjIGh0dHBzOiAndW5zYWZlLWV2YWwnICd1bnNhZmUtaW5saW5lJzsgc3R5bGUtc3JjIGh0dHBzOiAndW5zYWZlLWlubGluZSc7IGltZy1zcmMgaHR0cHM6IGRhdGE6OyBmb250LXNyYyBodHRwczogZGF0YTo7IHJlcG9ydC11cmkgL2NzcC1yZXBvcnQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54DQpEYXRlOiBGcmksIDE4IE9jdCAyMDE5IDEyOjA3OjE4IEdNVA0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0OyBjaGFyc2V0PVVURi04DQpDb250ZW50LUxlbmd0aDogODc0NzgNCkNvbm5lY3Rpb246IGtlZXAtYWxpdmUNCkxhc3QtTW9kaWZpZWQ6IFdlZCwgMjUgU2VwIDIwMTkgMTU6MjE6MDYgR01UDQpFVGFnOiAiNWQ4Yjg1ZTItMTU1YjYiDQpDYWNoZS1Db250cm9sOiBtdXN0LXJldmFsaWRhdGUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVNlY3VyaXR5LVBvbGljeS1SZXBvcnQtT25seTogZGVmYXVsdC1zcmMgaHR0cHM6OyBzY3JpcHQtc3JjIGh0dHBzOiAndW5zYWZlLWV2YWwnICd1bnNhZmUtaW5saW5lJzsgc3R5bGUtc3JjIGh0dHBzOiAndW5zYWZlLWlubGluZSc7IGltZy1zcmMgaHR0cHM6IGRhdGE6OyBmb250LXNyYyBodHRwczogZGF0YTo7IHJlcG9ydC11cmkgL2NzcC1yZXBvcnQNClN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHk6IG1heC1hZ2U9ODY0MDA7DQpDb250ZW50LVNlY3VyaXR5LVBvbGljeS1SZXBvcnQtT25seTogZGVmYXVsdC1zcmMgaHR0cHM6OyBzY3JpcHQtc3JjIGh0dHBzOiAndW5zYWZlLWV2YWwnICd1bnNhZmUtaW5saW5lJzsgc3R5bGUtc3JjIGh0dHBzOiAndW5zYWZlLWlubGluZSc7IGltZy1zcmMgaHR0cHM6IGRhdGE6OyBmb250LXNyYyBodHRwczogZGF0YTo7IHJlcG9ydC11cmkgL2NzcC1yZXBvcnQNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbCiAgICAnbmdSZXNvdXJjZScsCiAgICAndWkucm91dGVyJywKICAgICd1aS5ib290c3RyYXAnLAogICAgJ25nU3RvcmFnZScsCiAgICAnYW5ndWxhci1sb2FkaW5nLWJhcicsCiAgICAnYW5ndWxhci1leHRlbmQtcHJvbWlzZXMnLAogICAgJ2NoZWNrbGlzdC1tb2RlbCcsCiAgICAndWkuZ3JpZCcsCiAgICAndWkuZ3JpZC5wYWdpbmF0aW9uJywKICAgICd1aS5ncmlkLmF1dG9SZXNpemUnLAogICAgJ3lhbmRleC1tZXRyaWthJywKICAgICduZ1RhYmxlJywKICAgICd2YWxpZGF0aW9uJwpdKTsKCmlmICh3aW5kb3cpIHsKICAgIGFwcC5jb25zdGFudCgnJGNvbmZpZycsIHdpbmRvdy4kY29uZmlnKTsKfQoKYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHByb3ZpZGUsICRtZXRyaWthUHJvdmlkZXIsICRjb25maWcsICRsb2NhdGlvblByb3ZpZGVyKSB7CiAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJ0dyaWQnLCBmdW5jdGlvbiAoJGRlbGVnYXRlLCAkdGltZW91dCkgewogICAgICAgICRkZWxlZ2F0ZS5wcm90b3R5cGUucmVuZGVyaW5nQ29tcGxldGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLm9uUmVnaXN0ZXJBcGkpKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMub25SZWdpc3RlckFwaSh0aGlzLmFwaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5hcGkuY29yZS5yYWlzZS5yZW5kZXJpbmdDb21wbGV0ZSh0aGlzLmFwaSk7CiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciAkdmlld3BvcnQgPSAkKCcudWktZ3JpZC1yZW5kZXItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBbJ3RvdWNoc3RhcnQnLCAndG91Y2htb3ZlJywgJ3RvdWNoZW5kJywgJ2tleWRvd24nLCAnd2hlZWwnLCAnbW91c2V3aGVlbCcsICdEb21Nb3VzZVNjcm9sbCcsICdNb3pNb3VzZVBpeGVsU2Nyb2xsJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgJHZpZXdwb3J0LnVuYmluZChldmVudE5hbWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gJGRlbGVnYXRlOwogICAgfSk7CgogICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpOwoKICAgIGlmICgkY29uZmlnLmlzUHJvZCkgewogICAgICAgICRtZXRyaWthUHJvdmlkZXIuY29uZmlndXJlQ291bnRlcih7CiAgICAgICAgICAgIGlkOiAkY29uZmlnLnlhbmRleE1ldHJpa2FJZCwKICAgICAgICAgICAgY2xpY2ttYXA6IHRydWUsCiAgICAgICAgICAgIHRyYWNrTGlua3M6IHRydWUsCiAgICAgICAgICAgIGFjY3VyYXRlVHJhY2tCb3VuY2U6IHRydWUsCiAgICAgICAgICAgIHdlYnZpc29yOiB0cnVlLAogICAgICAgICAgICB0cmFja0hhc2g6IHRydWUKICAgICAgICB9KTsKICAgIH07Cn0pOwoKYXBwLmZhY3RvcnkoJ0F1dGgnLCBmdW5jdGlvbiBBdXRoKCRyb290U2NvcGUsICRzdGF0ZSwgJHEsIFByaW5jaXBhbCwgQXV0aFNlcnZlclByb3ZpZGVyLCBBY2NvdW50LCBSZWdpc3RlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjdGl2YXRlLCBBY3RpdmF0ZUV4aXN0LCBQYXNzd29yZCwgUGFzc3dvcmRSZXNldEluaXQsIFBhc3N3b3JkUmVzZXRGaW5pc2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXN0ZXJJbnRlZ3JhdGlvbixDdXN0b21lclJlZ2lzdGVyLCBQYXNzd29yZE5ldywgU3VjY2Vzc1BheSwgRmFpbFBheSwgVW5zdWJzY3JpYmUsIEdldFByaWNlKSB7CiAgICByZXR1cm4gewogICAgICAgIGxvZ2luOiBmdW5jdGlvbiAoY3JlZGVudGlhbHMsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBjYiA9IGNhbGxiYWNrIHx8IGFuZ3VsYXIubm9vcDsKICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTsKCiAgICAgICAgICAgIEF1dGhTZXJ2ZXJQcm92aWRlci5sb2dpbihjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgLy8gcmV0cmlldmUgdGhlIGxvZ2dlZCBhY2NvdW50IGluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICBQcmluY2lwYWwuaWRlbnRpdHkodHJ1ZSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7CiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTsKICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICB9LmJpbmQodGhpcykpOwoKICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7CiAgICAgICAgfSwKCiAgICAgICAgbG9nb3V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIEF1dGhTZXJ2ZXJQcm92aWRlci5sb2dvdXQoKTsKICAgICAgICAgICAgUHJpbmNpcGFsLmF1dGhlbnRpY2F0ZShudWxsKTsKICAgICAgICAgICAgLy8gUmVzZXQgc3RhdGUgbWVtb3J5CiAgICAgICAgICAgICRyb290U2NvcGUucHJldmlvdXNTdGF0ZU5hbWUgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICRyb290U2NvcGUucHJldmlvdXNTdGF0ZU5hbWVQYXJhbXMgPSB1bmRlZmluZWQ7CiAgICAgICAgfSwKCiAgICAgICAgYXV0aG9yaXplOiBmdW5jdGlvbiAoZm9yY2UpIHsKICAgICAgICAgICAgcmV0dXJuIFByaW5jaXBhbC5pZGVudGl0eShmb3JjZSkKICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGlzQXV0aGVudGljYXRlZCA9IFByaW5jaXBhbC5pc0F1dGhlbnRpY2F0ZWQoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gYW4gYXV0aGVudGljYXRlZCB1c2VyIGNhbid0IGFjY2VzcyB0byBsb2dpbiBhbmQgcmVnaXN0ZXIgcGFnZXMKICAgICAgICAgICAgICAgICAgICBpZiAoaXNBdXRoZW50aWNhdGVkICYmICRyb290U2NvcGUudG9TdGF0ZS5wYXJlbnQgPT09ICdhY2NvdW50JyAmJiAoJHJvb3RTY29wZS50b1N0YXRlLm5hbWUgPT09ICdsb2dpbicgfHwgJHJvb3RTY29wZS50b1N0YXRlLm5hbWUgPT09ICdyZWdpc3RlcicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoJHJvb3RTY29wZS50b1N0YXRlLmRhdGEuYXV0aG9yaXRpZXMgJiYgJHJvb3RTY29wZS50b1N0YXRlLmRhdGEuYXV0aG9yaXRpZXMubGVuZ3RoID4gMCAmJiAhUHJpbmNpcGFsLmhhc0FueUF1dGhvcml0eSgkcm9vdFNjb3BlLnRvU3RhdGUuZGF0YS5hdXRob3JpdGllcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXV0aGVudGljYXRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXNlciBpcyBzaWduZWQgaW4gYnV0IG5vdCBhdXRob3JpemVkIGZvciBkZXNpcmVkIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRzdGF0ZS5nbygnYWNjZXNzZGVuaWVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ25ld19tYWluX2luZGV4Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkLiBzdG93IHRoZSBzdGF0ZSB0aGV5IHdhbnRlZCBiZWZvcmUgeW91CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIHRoZW0gdG8gdGhlIHNpZ25pbiBzdGF0ZSwgc28geW91IGNhbiByZXR1cm4gdGhlbSB3aGVuIHlvdSdyZSBkb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnByZXZpb3VzU3RhdGVOYW1lID0gJHJvb3RTY29wZS50b1N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5wcmV2aW91c1N0YXRlTmFtZVBhcmFtcyA9ICRyb290U2NvcGUudG9TdGF0ZVBhcmFtczsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub3csIHNlbmQgdGhlbSB0byB0aGUgc2lnbmluIHN0YXRlIHNvIHRoZXkgY2FuIGxvZyBpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCduZXdfbWFpbl9pbmRleCcpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVBY2NvdW50OiBmdW5jdGlvbiAoYWNjb3VudCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2sgfHwgYW5ndWxhci5ub29wOwoKICAgICAgICAgICAgcmV0dXJuIFJlZ2lzdGVyLnNhdmUoYWNjb3VudCwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IoYWNjb3VudCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpLiRwcm9taXNlOwogICAgICAgIH0sCiAgICAgICAgY3JlYXRlU2lkZVRlc3RlckFjY291bnQ6IGZ1bmN0aW9uIChhY2NvdW50LCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgY2IgPSBjYWxsYmFjayB8fCBhbmd1bGFyLm5vb3A7CgogICAgICAgICAgICByZXR1cm4gVGVzdGVySW50ZWdyYXRpb24uc2F2ZShhY2NvdW50LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IoZGF0YSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpLiRwcm9taXNlOwogICAgICAgIH0sCiAgICAgICAgcmVnaXN0ZXJDdXN0b21lckJ5VGFyaWZmOiBmdW5jdGlvbiAoYWNjb3VudCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2sgfHwgYW5ndWxhci5ub29wOwoKICAgICAgICAgICAgcmV0dXJuIEN1c3RvbWVyUmVnaXN0ZXIuc2F2ZShhY2NvdW50LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IoZGF0YSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpLiRwcm9taXNlOwogICAgICAgIH0sCiAgICAgICAgdXBkYXRlQWNjb3VudDogZnVuY3Rpb24gKGFjY291bnQsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBjYiA9IGNhbGxiYWNrIHx8IGFuZ3VsYXIubm9vcDsKCiAgICAgICAgICAgIHJldHVybiBBY2NvdW50LnNhdmUoYWNjb3VudCwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IoYWNjb3VudCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKS4kcHJvbWlzZTsKICAgICAgICB9LAoKICAgICAgICBhY3RpdmF0ZUFjY291bnQ6IGZ1bmN0aW9uIChrZXlBbmRQYXNzd29yZCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2sgfHwgYW5ndWxhci5ub29wOwoKICAgICAgICAgICAgcmV0dXJuIEFjdGl2YXRlLnNhdmUoa2V5QW5kUGFzc3dvcmQua2V5QW5kUGFzc3dvcmQsIGZ1bmN0aW9uICh1c2VyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IodXNlcik7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICB9KS4kcHJvbWlzZTsKICAgICAgICB9LAoKICAgICAgICBleGlzdEtleTogZnVuY3Rpb24gKGtleSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2sgfHwgYW5ndWxhci5ub29wOwoKICAgICAgICAgICAgcmV0dXJuIFBhc3N3b3JkTmV3LmdldChrZXksCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSkuJHByb21pc2U7CiAgICAgICAgfSwKCiAgICAgICAgZXhpc3RBY3RpdmF0aW9uS2V5OiBmdW5jdGlvbiAoa2V5LCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgY2IgPSBjYWxsYmFjayB8fCBhbmd1bGFyLm5vb3A7CgogICAgICAgICAgICByZXR1cm4gQWN0aXZhdGVFeGlzdC5nZXQoa2V5LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpLiRwcm9taXNlOwogICAgICAgIH0sCgogICAgICAgIHN1Y2Nlc3NQYXk6IGZ1bmN0aW9uIChrZXksIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBjYiA9IGNhbGxiYWNrIHx8IGFuZ3VsYXIubm9vcDsKCiAgICAgICAgICAgIHJldHVybiBTdWNjZXNzUGF5LmdldChrZXksCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSkuJHByb21pc2U7CiAgICAgICAgfSwKCiAgICAgICAgdW5zdWJzY3JpYmU6IGZ1bmN0aW9uIChlbWFpbCwgc2lnbmF0dXJlLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgY2IgPSBjYWxsYmFjayB8fCBhbmd1bGFyLm5vb3A7CgogICAgICAgICAgICByZXR1cm4gVW5zdWJzY3JpYmUuZ2V0KHtlbWFpbDogZW1haWwsIHNpZ25hdHVyZTogc2lnbmF0dXJlfSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYihyZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKS4kcHJvbWlzZTsKICAgICAgICB9LAoKICAgICAgICBmYWlsUGF5OiBmdW5jdGlvbiAoa2V5LCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgY2IgPSBjYWxsYmFjayB8fCBhbmd1bGFyLm5vb3A7CgogICAgICAgICAgICByZXR1cm4gRmFpbFBheS5nZXQoa2V5LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpLiRwcm9taXNlOwogICAgICAgIH0sCgogICAgICAgIGNoYW5nZVBhc3N3b3JkOiBmdW5jdGlvbiAobmV3UGFzc3dvcmQsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBjYiA9IGNhbGxiYWNrIHx8IGFuZ3VsYXIubm9vcDsKCiAgICAgICAgICAgIHJldHVybiBQYXNzd29yZC5zYXZlKG5ld1Bhc3N3b3JkLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgICAgICAgIH0pLiRwcm9taXNlOwogICAgICAgIH0sCgogICAgICAgIHJlc2V0UGFzc3dvcmRJbml0OiBmdW5jdGlvbiAobWFpbCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2sgfHwgYW5ndWxhci5ub29wOwoKICAgICAgICAgICAgcmV0dXJuIFBhc3N3b3JkUmVzZXRJbml0LnNhdmUobWFpbCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICB9KS4kcHJvbWlzZTsKICAgICAgICB9LAoKICAgICAgICByZXNldFBhc3N3b3JkRmluaXNoOiBmdW5jdGlvbiAoa2V5QW5kUGFzc3dvcmQsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHZhciBjYiA9IGNhbGxiYWNrIHx8IGFuZ3VsYXIubm9vcDsKCiAgICAgICAgICAgIHJldHVybiBQYXNzd29yZFJlc2V0RmluaXNoLnNhdmUoa2V5QW5kUGFzc3dvcmQua2V5QW5kUGFzc3dvcmQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICAgICAgfSkuJHByb21pc2U7CiAgICAgICAgfSwKICAgICAgICBwcmljZTogZnVuY3Rpb24gKGVtYWlsLCBjb250YWN0LCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgY2IgPSBjYWxsYmFjayB8fCBhbmd1bGFyLm5vb3A7CgogICAgICAgICAgICByZXR1cm4gR2V0UHJpY2UuZ2V0KHtlbWFpbDplbWFpbCwgY29udGFjdDpjb250YWN0fSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICB9KS4kcHJvbWlzZTsKICAgICAgICB9CiAgICB9Owp9KTsKCmFwcC5zZXJ2aWNlKCdWYWxpZGF0aW9uU2VydmljZScsIGZ1bmN0aW9uKCkgewogICAgdmFyIHNjaGVtYXMgPSB7fTsKCiAgICByZXR1cm4gewogICAgICAgIC8vIExpc3Qgb2Ygc2NoZW1hcyBhcmUgc3RvcmVkIGhlcmUKICAgICAgICBzY2hlbWFzOiBzY2hlbWFzLAoKICAgICAgICAvLyBBZGRpbmcgc2NoZW1hIHRvIG9iamVjdAogICAgICAgIHNldDogZnVuY3Rpb24gKG5hbWUsIGhhc2gpIHsKICAgICAgICAgICAgc2NoZW1hc1tuYW1lXSA9IGhhc2g7CiAgICAgICAgfSwKCiAgICAgICAgLy8gZmV0Y2hpbmcgZnJvbSBvYmplY3QKICAgICAgICBnZXQ6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBzY2hlbWFzW25hbWVdOwogICAgICAgIH0KICAgIH0KfSk7CgoKLyoqCiAqIERpcmVjdGl2ZXMKICovCgphcHAuZGlyZWN0aXZlKCd2YWxpZGF0aW9uU2NoZW1hJywgWydWYWxpZGF0aW9uU2VydmljZScsIGZ1bmN0aW9uIChWYWxpZGF0aW9uU2VydmljZSkgewogICAgcmV0dXJuIHsKICAgICAgICByZXN0cmljdDogJ0FFJywKICAgICAgICBjb21waWxlOiBmdW5jdGlvbiAodEVsZW0sIHRBdHRycykgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIC8vIERlZmF1bHQgc2NoZW1hIHRvIGV4dGVuZCB1cG9uCiAgICAgICAgICAgIHZhciBkZWZhdWx0U2NoZW1hID0gewogICAgICAgICAgICAgICAgLy8gZGVmYXVsdCB2YWxpZGF0aW9uIGlzIHNldCB0byByZXF1aXJlZAogICAgICAgICAgICAgICAgJ3ZhbGlkYXRpb25zJzogJ3JlcXVpcmVkJywKICAgICAgICAgICAgICAgICd2YWxpZGF0ZS1vbic6ICd3YXRjaCcKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBnbG9iYWxNZXNzYWdlcyA9IHt9OwoKICAgICAgICAgICAgY29uc29sZS5sb2codEF0dHJzKQogICAgICAgICAgICBjb25zb2xlLmxvZyhWYWxpZGF0aW9uU2VydmljZSkKCiAgICAgICAgICAgIC8vIEdyYWJiaW5nIHNjaGVtYSB0aGUgdXNlciB3YW50cwogICAgICAgICAgICB2YXIgc2NoZW1hID0gVmFsaWRhdGlvblNlcnZpY2UuZ2V0KHRBdHRycy5zY2hlbWEpOwoKICAgICAgICAgICAgaWYgKHNjaGVtYSkgewoKICAgICAgICAgICAgICAgIC8vIElmIGl0IGlzIGFuIHZhbGlkIHNjaGVtYSAsIHRoZW4gc2V0Rml4dHVyZXMKICAgICAgICAgICAgICAgIHNldEZpeHR1cmVzKHNjaGVtYSk7CgogICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBzaG93IHdhcm5pbmcgb2Ygbm9uLWV4aXN0aW5nIHNjaGVtYQogICAgICAgICAgICAgICAgd2FybkRldmVsb3Blcih0QXR0cnMuc2NoZW1hKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gV2FybiBkZXZlbG9wZXIgbWV0aG9kCiAgICAgICAgICAgIGZ1bmN0aW9uIHdhcm5EZXZlbG9wZXIoc2NoZW1hKSB7CgogICAgICAgICAgICAgICAgLy8gRXJyb3IgbWVzc2FnZQogICAgICAgICAgICAgICAgdmFyIGVycm9yX21lc3NhZ2UgPSBzY2hlbWEgKyAnIFNjaGVtYSBub3QgZm91bmQnOwoKICAgICAgICAgICAgICAgIC8vIE91dHB1dHRpbmcgdG8gY29uc29sZQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdWQUxJREFUSU9OIFNDSEVNQSA6JywgZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEZpeHR1cmVzKHNjaGVtYSkgewoKICAgICAgICAgICAgICAgIC8vIElmIHNjaGVtYSBoYXMgZ2xvYmFscwogICAgICAgICAgICAgICAgaWYgKHNjaGVtYS5nbG9iYWxzKSB7CgogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBkZWZhdWx0U2NoZW1hIHZhbGlkYXRpb25zIHdpdGggZ2xvYmFscwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRTY2hlbWEudmFsaWRhdGlvbnMgPSBzY2hlbWEuZ2xvYmFscy52YWxpZGF0aW9ucyB8fCBkZWZhdWx0U2NoZW1hLnZhbGlkYXRpb25zOwoKICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdmFsaWRhdGUtb24gdmFsaWRhdGlvbnMgd2l0aCBnbG9iYWxzCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFNjaGVtYVsidmFsaWRhdGUtb24iXSA9IHNjaGVtYS5nbG9iYWxzWyJ2YWxpZGF0ZS1vbiJdIHx8IGRlZmF1bHRTY2hlbWFbInZhbGlkYXRlLW9uIl07CgogICAgICAgICAgICAgICAgICAgIC8vIFNldCBnbG9iYWxNZXNzYWdlcyBpZiBnbG9iYWxzIGhhdmUgb25lIG9yIGVtcHR5IG9iamVjdAogICAgICAgICAgICAgICAgICAgIGdsb2JhbE1lc3NhZ2VzID0gc2NoZW1hLmdsb2JhbHMubWVzc2FnZXMgfHwge307CgogICAgICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBzY2hlbWEgZ2xvYmFscyBhcyBub3QgcmVxdWlyZWQgYW55bW9yZQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBzY2hlbWEuZ2xvYmFsczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBEZWVwIGV4dGVuZGluZyBvYmplY3RzCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBleHRlbmREZWVwKGRzdCkgewogICAgICAgICAgICAgICAgICAgIC8vIExvb3BpbmcgdGhyb3VnaCBhbGwgdGhlIHZhbHVlcwogICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChhcmd1bWVudHMsIGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiAhPT0gZHN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gob2JqLCBmdW5jdGlvbiAodmFsdWUsIGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkc3Rba2V5XSAmJiBkc3Rba2V5XS5jb25zdHJ1Y3RvciAmJiBkc3Rba2V5XS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcnVuIGlmIGFib3ZlIGtleSBpcyBhbiBPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kRGVlcChkc3Rba2V5XSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dGVuZCBoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRzdFtrZXldID0gZHN0W2tleV0gfHwgdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRzdDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBHcmFiYmluZyBhbGwgZm9ybSBlbGVtZW50cyBpbnNpZGUgdGhlIHRFbGVtCiAgICAgICAgICAgICAgICB2YXIgZm9ybUVsZW1lbnRzID0gdEVsZW1bMF0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQsc2VsZWN0LHRleHRhcmVhJyk7CgogICAgICAgICAgICAgICAgLy8gTG9vcGluZyB0aHJvdWdoIGFsbCBmb3JtIEVsZW1lbnRzCiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZm9ybUVsZW1lbnRzLCBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBHZXR0aW5nIGluc3RhbmNlIG9mIGFuZ3VsYXIgZWxlbWVudAogICAgICAgICAgICAgICAgICAgIHZhciBpID0gYW5ndWxhci5lbGVtZW50KGlucHV0KTsKICAgICAgICAgICAgICAgICAgICB2YXIgaW5wdXRfbmFtZSA9IGkuYXR0cignbmFtZScpOwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiBzY2hlbWEgZGVmaW5hdGlvbiBleGlzdHMKICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hW2lucHV0X25hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZXAgZXh0ZW5kIHJ1bGVzIHRvIHNhdmUgdW5kZWZpbmVkIHN0dWZmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpX3NjaGVtYSA9IGV4dGVuZERlZXAoc2NoZW1hW2lucHV0X25hbWVdLCBkZWZhdWx0U2NoZW1hKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0dGluZyB2YWxpZGF0b3Igb24gZmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgaS5hdHRyKCd2YWxpZGF0b3InLCBpX3NjaGVtYS52YWxpZGF0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldHRpbmcgdmFsaWQtbWV0aG9kIG9uIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgIGkuYXR0cigndmFsaWQtbWV0aG9kJywgaV9zY2hlbWFbJ3ZhbGlkYXRlLW9uJ10pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0ZW5kcyBtZXNzYWdlcyB1c2luZyBnbG9iYWwgYW5kIGZpZWxkIHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICBpX3NjaGVtYS5tZXNzYWdlcyA9IGlfc2NoZW1hLm1lc3NhZ2VzIHx8IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBpX3NjaGVtYS5tZXNzYWdlcyA9IGV4dGVuZERlZXAoaV9zY2hlbWEubWVzc2FnZXMsIGdsb2JhbE1lc3NhZ2VzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvb3BpbmcgdGhyb3VnaCBtZXNzYWdlcyBvYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGlfc2NoZW1hLm1lc3NhZ2VzLCBmdW5jdGlvbiAodmFscywga2V5KSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JhYmJpbmcgZXJyb3IgbWVzc2FnZSBhbmQgcmVwbGFjZSAlZmllbGQlIHdpdGggaW5wdXQgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yX21lc3NhZ2UgPSB2YWxzLmVycm9yID8gdmFscy5lcnJvci5yZXBsYWNlKCclZmllbGQlJywgaW5wdXRfbmFtZSkgOiAnJzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHcmFiYmluZyBzdWNjZXNzIG1lc3NhZ2UgYW5kIHJlcGxhY2UgJWZpZWxkJSB3aXRoIGlucHV0IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzX21lc3NhZ2UgPSB2YWxzLnN1Y2Nlc3MgPyB2YWxzLnN1Y2Nlc3MucmVwbGFjZSgnJWZpZWxkJScsIGlucHV0X25hbWUpIDogJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0dGluZyBlcnJvciBtZXNzYWdlIGZvciB2YWxpZGF0aW9uIHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYXR0cihrZXkgKyAnLWVycm9yLW1lc3NhZ2UnLCBlcnJvcl9tZXNzYWdlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXR0aW5nIHN1Y2Nlc3MgbWVzc2FnZSBmb3IgdmFsaWRhdGlvbiB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmF0dHIoa2V5ICsgJy1zdWNjZXNzLW1lc3NhZ2UnLCBzdWNjZXNzX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9CiAgICB9Cn1dKTsKCmFwcC5kaXJlY3RpdmUoInBheXBhbCIsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRjb25maWcsICRjb21waWxlLCAkd2luZG93LCAkc3RhdGUpIHsKICByZXR1cm4gewogICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdGxzKSB7CiAgICAgICAgc2NvcGUuYXR0cnM9YXR0cnM7CiAgICAgICAgcGF5cGFsLkJ1dHRvbi5yZW5kZXIoewoKICAgICAgICAgICAgZW52OiAkY29uZmlnLnBheXBhbE1vZGUsIC8vIHNhbmRib3ggfCBwcm9kdWN0aW9uCiAgICAgICAgICAgIC8vIFNob3cgdGhlIGJ1eWVyIGEgJ1BheSBOb3cnIGJ1dHRvbiBpbiB0aGUgY2hlY2tvdXQgZmxvdwogICAgICAgICAgICBjb21taXQ6IHRydWUsCgogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdwYXknLAogICAgICAgICAgICAgICAgICAgICAgZnVuZGluZ2ljb25zOiB0cnVlLCAvLyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgICAgYnJhbmRpbmc6IHRydWUsIC8vIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgICBzaXplOiAgJ21lZGl1bScsIC8vIHNtYWxsIHwgbWVkaXVtIHwgbGFyZ2UgfCByZXNwb25zaXZlCiAgICAgICAgICAgICAgICAgICAgICBzaGFwZTogJ3JlY3QnLCAgIC8vIHBpbGwgfCByZWN0CiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ2dvbGQnICAgLy8gZ29sZCB8IGJsdWUgfCBzaWx2ZSB8IGJsYWNrCiAgICAgICAgICAgICAgICAgIH0sCgoKICAgICAgICAgICAgLy8gU3BlY2lmeSBhbGxvd2VkIGFuZCBkaXNhbGxvd2VkIGZ1bmRpbmcgc291cmNlcwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBPcHRpb25zOgogICAgICAgICAgICAvLyAtIHBheXBhbC5GVU5ESU5HLkNBUkQKICAgICAgICAgICAgLy8gLSBwYXlwYWwuRlVORElORy5DUkVESVQKICAgICAgICAgICAgLy8gLSBwYXlwYWwuRlVORElORy5FTFYKCiAgICAgICAgICAgIGZ1bmRpbmc6IHsKICAgICAgICAgICAgICAgIGFsbG93ZWQ6IFsgcGF5cGFsLkZVTkRJTkcuQ0FSRCwgcGF5cGFsLkZVTkRJTkcuQ1JFRElUIF0sCiAgICAgICAgICAgICAgICBkaXNhbGxvd2VkOiBbIF0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIHBheW1lbnQoKSBpcyBjYWxsZWQgd2hlbiB0aGUgYnV0dG9uIGlzIGNsaWNrZWQKICAgICAgICAgICAgcGF5bWVudDogZnVuY3Rpb24oKSB7CgogICAgICAgICAgICAgICAgLy8gU2V0IHVwIGEgdXJsIG9uIHlvdXIgc2VydmVyIHRvIGNyZWF0ZSB0aGUgcGF5bWVudAogICAgICAgICAgICAgICAgdmFyIENSRUFURV9VUkwgPSAnL2FwaS9wdWJsaWMvcGF5bWVudFBheVBhbEluaXRSZXF1ZXN0JzsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgICAgICAgIGlkOiBzY29wZS5hdHRycy5vcmRlcmlkCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIE1ha2UgYSBjYWxsIHRvIHlvdXIgc2VydmVyIHRvIHNldCB1cCB0aGUgcGF5bWVudAogICAgICAgICAgICAgICAgcmV0dXJuIHBheXBhbC5yZXF1ZXN0LnBvc3QoQ1JFQVRFX1VSTCwgZGF0YSkKICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGF5bWVudElEID0gcmVzLmlkOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLmlkOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLy8gb25BdXRob3JpemUoKSBpcyBjYWxsZWQgd2hlbiB0aGUgYnV5ZXIgYXBwcm92ZXMgdGhlIHBheW1lbnQKICAgICAgICAgICAgb25BdXRob3JpemU6IGZ1bmN0aW9uKGRhdGEsIGFjdGlvbnMpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHNjb3BlKTsKICAgICAgICAgICAgICAgIC8vIFNldCB1cCBhIHVybCBvbiB5b3VyIHNlcnZlciB0byBleGVjdXRlIHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICB2YXIgRVhFQ1VURV9VUkwgPSAnL2FwaS9wdWJsaWMvcGF5bWVudFBheVBhbEV4ZWN1dGVSZXF1ZXN0JzsKCiAgICAgICAgICAgICAgICAvLyBTZXQgdXAgdGhlIGRhdGEgeW91IG5lZWQgdG8gcGFzcyB0byB5b3VyIHNlcnZlcgogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRJZDogZGF0YS5wYXltZW50SUQsCiAgICAgICAgICAgICAgICAgICAgIFBheWVySUQ6IGRhdGEucGF5ZXJJRAogICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAvLyBNYWtlIGEgY2FsbCB0byB5b3VyIHNlcnZlciB0byBleGVjdXRlIHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICByZXR1cm4gcGF5cGFsLnJlcXVlc3QucG9zdChFWEVDVVRFX1VSTCwgZGF0YSkKICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5hdHRycy50ZXN0ZXJ0eXBlIT1udWxsICYmIHNjb3BlLmF0dHJzLnRlc3RlcnR5cGU9PSdUSEVJUicpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxvY2F0aW9uPSRjb25maWcuZnVsbFVybCsnL2FwcC1jdXN0b21lci1ob21lL29yZGVyLWluZm8/aWQ9JytzY29wZS5hdHRycy5vcmRlcmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3VjY2VzcycsIHtub3RpZnk6IGZhbHNlfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPSA0MDUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbGlzdC1vcmRlcnMnLCB7fSwge3JlbG9hZDogdHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7OwogICAgICAgICAgICB9CgogICAgICAgIH0sICcjcGF5cGFsLWJ1dHRvbi1jb250YWluZXInKTsKICAgIH0KICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoInBheXBhbHRhcmlmZiIsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRjb25maWcsICRjb21waWxlLCAkd2luZG93LCAkc3RhdGUsIFRyYW5zbGF0aW9uKSB7CiAgcmV0dXJuIHsKICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycykgewogICAgICAgICRyb290U2NvcGUucGF5cGFsUGF5ZWQ9ZmFsc2U7CiAgICAgICAgc2NvcGUucm9vdFNjb3BlPSRyb290U2NvcGU7CiAgICAgICAgc2NvcGUuc3RhdGU9JHN0YXRlOwoKICAgICAgICBzY29wZS50cmFuc2xhdGlvbj1UcmFuc2xhdGlvbjsKICAgICAgICBwYXlwYWwuQnV0dG9uLnJlbmRlcih7CgogICAgICAgICAgICBlbnY6ICRjb25maWcucGF5cGFsTW9kZSwgLy8gc2FuZGJveCB8IHByb2R1Y3Rpb24KICAgICAgICAgICAgLy8gU2hvdyB0aGUgYnV5ZXIgYSAnUGF5IE5vdycgYnV0dG9uIGluIHRoZSBjaGVja291dCBmbG93CiAgICAgICAgICAgIGNvbW1pdDogdHJ1ZSwKCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ3BheScsCiAgICAgICAgICAgICAgICAgICAgICBmdW5kaW5naWNvbnM6IHRydWUsIC8vIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgICBicmFuZGluZzogdHJ1ZSwgLy8gb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICAgIHNpemU6ICAnbWVkaXVtJywgLy8gc21hbGwgfCBtZWRpdW0gfCBsYXJnZSB8IHJlc3BvbnNpdmUKICAgICAgICAgICAgICAgICAgICAgIHNoYXBlOiAncmVjdCcsICAgLy8gcGlsbCB8IHJlY3QKICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZ29sZCcgICAvLyBnb2xkIHwgYmx1ZSB8IHNpbHZlIHwgYmxhY2sKICAgICAgICAgICAgICAgICAgfSwKCgogICAgICAgICAgICAvLyBTcGVjaWZ5IGFsbG93ZWQgYW5kIGRpc2FsbG93ZWQgZnVuZGluZyBzb3VyY2VzCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIE9wdGlvbnM6CiAgICAgICAgICAgIC8vIC0gcGF5cGFsLkZVTkRJTkcuQ0FSRAogICAgICAgICAgICAvLyAtIHBheXBhbC5GVU5ESU5HLkNSRURJVAogICAgICAgICAgICAvLyAtIHBheXBhbC5GVU5ESU5HLkVMVgoKICAgICAgICAgICAgZnVuZGluZzogewogICAgICAgICAgICAgICAgYWxsb3dlZDogWyBwYXlwYWwuRlVORElORy5DQVJELCBwYXlwYWwuRlVORElORy5DUkVESVQgXSwKICAgICAgICAgICAgICAgIGRpc2FsbG93ZWQ6IFsgXQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLy8gcGF5bWVudCgpIGlzIGNhbGxlZCB3aGVuIHRoZSBidXR0b24gaXMgY2xpY2tlZAogICAgICAgICAgICBwYXltZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNjb3BlLnJvb3RTY29wZS50YXJpZmZFbWFpbEZpbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzY29wZS5yb290U2NvcGUuJGFwcGx5KCk7CiAgICAgICAgICAgICAgICAkKCcjcHJpY2VfZXJyb3JzX2Jsb2NrJykudGV4dCgnJyk7CiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucm9vdFNjb3BlLnRhcmlmZkVtYWlsPT1udWxsKXsKICAgICAgICAgICAgICAgICAgICBzY29wZS5yb290U2NvcGUudGFyaWZmRW1haWxGaWxsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBzY29wZS5yb290U2NvcGUuJGFwcGx5KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBTZXQgdXAgYSB1cmwgb24geW91ciBzZXJ2ZXIgdG8gY3JlYXRlIHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICB2YXIgQ1JFQVRFX1VSTCA9ICcvYXBpL3B1YmxpYy9wYXltZW50UGF5UGFsSW5pdFJlcXVlc3RUYXJpZmYnOwogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHNjb3BlLnJvb3RTY29wZS50YXJpZmZFbWFpbCwKICAgICAgICAgICAgICAgICAgICBoYXNGcmVlOiBzY29wZS5yb290U2NvcGUuaGFzRnJlZQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBNYWtlIGEgY2FsbCB0byB5b3VyIHNlcnZlciB0byBzZXQgdXAgdGhlIHBheW1lbnQKICAgICAgICAgICAgICAgIHJldHVybiBwYXlwYWwucmVxdWVzdC5wb3N0KENSRUFURV9VUkwsIGRhdGEpCiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBheW1lbnRJRCA9IHJlcy5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5pZDsKICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlLmluZGV4T2YoIkVfTUFJTF9BRERSRVNTX0FMUkVBRFlfSU5fVVNFIikhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3ByaWNlX2Vycm9yc19ibG9jaycpLnRleHQoc2NvcGUudHJhbnNsYXRpb24udHJhbnNsYXRlKCdMVFIuTFRSMTMnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZS5pbmRleE9mKCJDVVNUT01FUl9BTFJFQURZX0hBU19QQVlFRF9UQVJJRkYiKSE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcHJpY2VfZXJyb3JzX2Jsb2NrJykudGV4dChzY29wZS50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ0xUUi5MVFIxNCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlLmluZGV4T2YoIkNVU1RPTUVSX0FMUkVBRFlfSEFTX0ZSRUVfVEFSSUZGIikhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucm9vdFNjb3BlLmhhc0ZyZWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yb290U2NvcGUuJGFwcGx5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZS5pbmRleE9mKCJFX01BSUxfQUREUkVTU19BTFJFQURZX0FTX1RFU1RFUiIpIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwcmljZV9lcnJvcnNfYmxvY2snKS50ZXh0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnTFRSLkxUUjE1JykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvLyBvbkF1dGhvcml6ZSgpIGlzIGNhbGxlZCB3aGVuIHRoZSBidXllciBhcHByb3ZlcyB0aGUgcGF5bWVudAogICAgICAgICAgICBvbkF1dGhvcml6ZTogZnVuY3Rpb24oZGF0YSwgYWN0aW9ucykgewoKICAgICAgICAgICAgICAgIC8vIFNldCB1cCBhIHVybCBvbiB5b3VyIHNlcnZlciB0byBleGVjdXRlIHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICB2YXIgRVhFQ1VURV9VUkwgPSAnL2FwaS9wdWJsaWMvcGF5bWVudFBheVBhbEV4ZWN1dGVSZXF1ZXN0VGFyaWZmJzsKCiAgICAgICAgICAgICAgICAvLyBTZXQgdXAgdGhlIGRhdGEgeW91IG5lZWQgdG8gcGFzcyB0byB5b3VyIHNlcnZlcgogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRJZDogZGF0YS5wYXltZW50SUQsCiAgICAgICAgICAgICAgICAgICAgIFBheWVySUQ6IGRhdGEucGF5ZXJJRAogICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAvLyBNYWtlIGEgY2FsbCB0byB5b3VyIHNlcnZlciB0byBleGVjdXRlIHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICByZXR1cm4gcGF5cGFsLnJlcXVlc3QucG9zdChFWEVDVVRFX1VSTCwgZGF0YSkKICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJvb3RTY29wZS5wYXlwYWxQYXllZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc3VjY2VzcyA9ICdPSyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmVycm9yID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9ICJPSyI7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJvb3RTY29wZS5zdWNjZXNzTWVzc2FnZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdoZWFkZXInOiBzY29wZS50cmFuc2xhdGlvbi50cmFuc2xhdGUoJ0xDVC5MQ1QyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nOiAnQ2hlY2sgdGhlIHlvdXIgRW1haWw6IHRoZSBhY3RpdmF0aW9uIGxpbmsgc2hvdWxkIGFscmVhZHkgYmUgdGhlcmUuIElmIHlvdSBkbyBub3QgYXBwZWFyIGluIHRoZSBpbmJveCBvciBzcGFtIGZvbGRlciwgd3JpdGUgdG8gdXMgaW4gdGhlIGNoYXQnCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnN0YXRlLmdvKCdzdWNjZXNzJywge25vdGlmeTogZmFsc2V9LCB7cmVsb2FkOiB0cnVlfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnN0YXRlLmdvKCdsaXN0LW9yZGVycycsIHt9LCB7cmVsb2FkOiB0cnVlfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwgJyNwYXlwYWwtYnV0dG9uLWNvbnRhaW5lci10YXJpZmYnKTsKICAgIH0KICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoIm5nVHIiLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkY29uZmlnLCAkY29tcGlsZSwgJHdpbmRvdykgewogIHJldHVybiB7CiAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsbSwgYXR0cnMsIGN0bHMpIHsKICAgICAgICBjb25zdCBsYWJlbENvZGUgPSBhdHRycy5uZ1RyCgogICAgICAgIHZhciBtYXBMYWJlbHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoZWxtKS5odG1sKCRjb25maWcudHJhbnNsYXRpb25bbGFiZWxDb2RlLnNwbGl0KCcuJylbMF1dW2xhYmVsQ29kZS5zcGxpdCgnLicpWzFdXSk7CiAgICAgICAgfTsKICAgICAgICBtYXBMYWJlbHMoKTsKICAgIH0KICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoJ2luY29tZWVsJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIGVsbS5iaW5kKCdrZXl1cCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChOdW1iZXIoJChlbG0pLnZhbCgpLnJlcGxhY2UoJyAnLCAnJykpID4gNTAwMDApIHsKICAgICAgICAgICAgICAgICAgICAkKCcuYmxvY2tfcmFuZ2VfanMnKS5zbGlkZXIoJ3ZhbHVlJywgNTUwMDApOwogICAgICAgICAgICAgICAgICAgICQoZWxtKS52YWwoJzUwIDAwMCsnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKE51bWJlcigkKGVsbSkudmFsKCkucmVwbGFjZSgnICcsICcnKSkgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmJsb2NrX3JhbmdlX2pzJykuc2xpZGVyKCd2YWx1ZScsIDApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS52YWwoZm9ybWF0X3ByaWNlKCQoZWxtKS52YWwoKS5yZXBsYWNlKC9cRCsvZywgIiIpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQoJy5ibG9ja19yYW5nZV9qcycpLnNsaWRlcigndmFsdWUnLCAkKGVsbSkudmFsKCkucmVwbGFjZSgvXEQrL2csICIiKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWxtLmJpbmQoJ2ZvY3VzJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJChlbG0pLnZhbChmb3JtYXRfcHJpY2UoJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpKTsKICAgICAgICAgICAgICAgICQoJy5ibG9ja19yYW5nZV9qcycpLnNsaWRlcigndmFsdWUnLCAkKGVsbSkudmFsKCkucmVwbGFjZSgvXEQrL2csICIiKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbG0uYmluZCgnYmx1cicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICgkKGVsbSkudmFsKCk9PSc1MCAwMDArJyl7CiAgICAgICAgICAgICAgICAgICAgJCgnLmJsb2NrX3JhbmdlX2pzJykuc2xpZGVyKCd2YWx1ZScsIDU1MDAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJChlbG0pLnZhbChmb3JtYXRfcHJpY2UoJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpKTsKICAgICAgICAgICAgICAgICAgICAkKCcuYmxvY2tfcmFuZ2VfanMnKS5zbGlkZXIoJ3ZhbHVlJywgJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0pOwoKYXBwLmRpcmVjdGl2ZSgnZm9ybWF0cHJpY2UnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJywKICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsbSwgYXR0cnMsIGN0cmwpIHsKICAgICAgICAgICAgZWxtLmJpbmQoJ2tleXVwJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJChlbG0pLnZhbChmb3JtYXRfcHJpY2UoJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQp9KTsKCmFwcC5kaXJlY3RpdmUoJ21hc2tudW1iZXInLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJywKICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsbSwgYXR0cnMsIGN0cmwpIHsKICAgICAgICAgICAgZWxtLmJpbmQoJ2tleXVwJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKE5VTUJFUl9SRUdFWFAuZXhlYygkKGVsbSkudmFsKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZWxtKS52YWwoKSA+IE51bWJlcihhdHRycy5tYXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS52YWwoYXR0cnMubWF4KTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5ibG9ja19zbGlkZXJfY291bnQnKS5maW5kKCcuY291bnRfc2xpZGVyJykuc2xpZGVyKCJ2YWx1ZSIsIE51bWJlcihhdHRycy5tYXgpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCQoZWxtKS52YWwoKSA9PSAnMCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5ibG9ja19zbGlkZXJfY291bnQnKS5maW5kKCcuY291bnRfc2xpZGVyJykuc2xpZGVyKCJ2YWx1ZSIsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkudmFsKCcxJyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5ibG9ja19zbGlkZXJfY291bnQnKS5maW5kKCcuY291bnRfc2xpZGVyJykuc2xpZGVyKCJ2YWx1ZSIsICQoZWxtKS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJChlbG0pLnZhbCgpICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS52YWwoJzEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5ibG9ja19zbGlkZXJfY291bnQnKS5maW5kKCcuY291bnRfc2xpZGVyJykuc2xpZGVyKCJ2YWx1ZSIsIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNjb3BlLmFwcGx5OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWxtLmJpbmQoJ2ZvY3Vzb3V0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCQoZWxtKS52YWwoKSA9PSAnJykgewogICAgICAgICAgICAgICAgICAgICQoZWxtKS52YWwoJzEnKTsKICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLmJsb2NrX3NsaWRlcl9jb3VudCcpLmZpbmQoJy5jb3VudF9zbGlkZXInKS5zbGlkZXIoInZhbHVlIiwgMSk7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYXBwbHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfSk7CgphcHAuZGlyZWN0aXZlKCdtYXNrbnVtYmVyaW5jb21lJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIGVsbS5iaW5kKCdrZXl1cCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICgkKGVsbSkuaGFzQ2xhc3MoJ21heF92YWwnKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChOdW1iZXIoJChlbG0pLnZhbCgpLnJlcGxhY2UoJyAnLCAnJykucmVwbGFjZSgnKycsICcnKSkgPiA1MDAwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLmhvdXNlaG9sZEluY29tZU1heCA9ICc1MCAwMDArJzsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmluY29tZScpLnNsaWRlcigidmFsdWVzIiwgMSwgNTUwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkudmFsKCc1MCAwMDArJyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE51bWJlcigkKGVsbSkudmFsKCkucmVwbGFjZSgnICcsICcnKSkgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5pbmNvbWUnKS5zbGlkZXIoInZhbHVlcyIsIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnZhbChmb3JtYXRfcHJpY2UoJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpLnJlcGxhY2UoIiAiLCAiIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNYXggPSBmb3JtYXRfcHJpY2UoJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpLnJlcGxhY2UoIiAiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcuaW5jb21lJykuc2xpZGVyKCJ2YWx1ZXMiLCAxLCAkKGVsbSkudmFsKCkucmVwbGFjZSgvXEQrL2csICIiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmluY29tZScpLnNsaWRlcigidmFsdWVzIiwgMSwgJChlbG0pLnZhbCgpLnJlcGxhY2UoL1xEKy9nLCAiIikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkKGVsbSkuaGFzQ2xhc3MoJ21pbl92YWwnKSkgewogICAgICAgICAgICAgICAgICAgICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5pbmNvbWUnKS5zbGlkZXIoInZhbHVlcyIsIDAsICQoZWxtKS52YWwoKS5yZXBsYWNlKC9cRCsvZywgIiIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWxtLmJpbmQoJ2ZvY3Vzb3V0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCQoZWxtKS52YWwoKSA9PSAnJykgewogICAgICAgICAgICAgICAgICAgIGlmICgkKGVsbSkuaGFzQ2xhc3MoJ21heF92YWwnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLmhvdXNlaG9sZEluY29tZU1heCA9ICc1MCAwMDArJzsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmluY29tZScpLnNsaWRlcigidmFsdWVzIiwgMSwgNTUwMDApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWluID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmluY29tZScpLnNsaWRlcigidmFsdWVzIiwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWF4ID09IHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWluKSB7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNaW4gPT0gNTAwMDAgPwogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLmhvdXNlaG9sZEluY29tZU1heCA9ICc1MCAwMDArJyA6CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWF4ID0gc2NvcGUucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNaW4gKyA1MDAwCiAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmluY29tZScpLnNsaWRlcigndmFsdWVzJywgMSwgTnVtYmVyKHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWluICsgNTAwMCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWF4IDwgc2NvcGUucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNaW4pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWluID0gc2NvcGUucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNYXg7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1heCA9IHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWluOwogICAgICAgICAgICAgICAgICAgICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5pbmNvbWUnKS5zbGlkZXIoJ3ZhbHVlcycsIDAsIE51bWJlcihtaW4pKTsKICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcuaW5jb21lJykuc2xpZGVyKCd2YWx1ZXMnLCAxLCBOdW1iZXIobWF4KSk7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNaW4gPSBOdW1iZXIobWluKTsKICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLmhvdXNlaG9sZEluY29tZU1heCA9IE51bWJlcihtYXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfSk7CgphcHAuZGlyZWN0aXZlKCdtYXNrbnVtYmVyYWdlJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIGVsbS5iaW5kKCdrZXl1cCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoJChlbG0pLnZhbCgpID09ICc2MCsnIHx8ICQoZWxtKS52YWwoKS5zcGxpdCgnKycpWzBdID09ICc2MCcpIHsKICAgICAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoJChlbG0pLnZhbCgpLnNwbGl0KCcrJylbMF0gPT0gJzYwJykgewogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkudmFsKCc2MCsnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoTlVNQkVSX1RXT19DSEFSLmV4ZWMoJChlbG0pLnZhbCgpKSB8fCBmbGFnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkKGVsbSkudmFsKCkgPiA2MCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoZWxtKS5oYXNDbGFzcygnbWF4X3ZhbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1heEFnZSA9ICc2MCsnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmFnZScpLnNsaWRlcigndmFsdWVzJywgMSwgNjEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1pbkFnZSA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmFnZScpLnNsaWRlcigndmFsdWVzJywgMCwgMTgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgkKGVsbSkudmFsKCkgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoZWxtKS5oYXNDbGFzcygnbWF4X3ZhbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1heEFnZSA9IDE5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmFnZScpLnNsaWRlcigidmFsdWVzIiwgMSwgMTkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFydGljaXBhbnRHcm91cC5taW5BZ2UgPSAxODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5hZ2UnKS5zbGlkZXIoInZhbHVlcyIsIDAsIDE4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWxtLmJpbmQoJ2ZvY3Vzb3V0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCgkKGVsbSkudmFsKCkgPiA2MCkgfHwgKCQoZWxtKS52YWwoKSA8IDE4KSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkKGVsbSkuaGFzQ2xhc3MoJ21heF92YWwnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1heEFnZSA9ICc2MCsnOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcuYWdlJykuc2xpZGVyKCd2YWx1ZXMnLCAxLCA2MSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1pbkFnZSA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcuYWdlJykuc2xpZGVyKCd2YWx1ZXMnLCAwLCAxOCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJChlbG0pLnZhbCgpID09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZWxtKS5oYXNDbGFzcygnbWF4X3ZhbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnRpY2lwYW50R3JvdXAubWF4QWdlID0gMTk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5hZ2UnKS5zbGlkZXIoInZhbHVlcyIsIDEsIDE5KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1pbkFnZSA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcuYWdlJykuc2xpZGVyKCJ2YWx1ZXMiLCAwLCAxOCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5hZ2UnKS5zbGlkZXIoJ3ZhbHVlcycpWzFdIDwgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmFnZScpLnNsaWRlcigndmFsdWVzJylbMF0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWluID0gJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLmFnZScpLnNsaWRlcigndmFsdWVzJylbMV07CiAgICAgICAgICAgICAgICAgICAgdmFyIG1heCA9ICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5hZ2UnKS5zbGlkZXIoJ3ZhbHVlcycpWzBdOwogICAgICAgICAgICAgICAgICAgICQoZWxtKS5wYXJlbnRzKCcubWFpbl9pdGVtX2V4cGFuZF9ibG9jaycpLmZpbmQoJy5hZ2UnKS5zbGlkZXIoJ3ZhbHVlcycsIDAsIE51bWJlcihtaW4pKTsKICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcuYWdlJykuc2xpZGVyKCd2YWx1ZXMnLCAxLCBOdW1iZXIobWF4KSk7CiAgICAgICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy5tYWluX2l0ZW1fZXhwYW5kX2Jsb2NrJykuZmluZCgnLm1heF92YWwnKS52YWwobWF4KTsKICAgICAgICAgICAgICAgICAgICAkKGVsbSkucGFyZW50cygnLm1haW5faXRlbV9leHBhbmRfYmxvY2snKS5maW5kKCcubWluX3ZhbCcpLnZhbChtaW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfSk7CgphcHAuZGlyZWN0aXZlKCdjdXN0b21pbnB1dCcsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLAogICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgY3RybCkgewogICAgICAgICAgICB2YXIgZWxtX3BhcmVudHMgPSAkKGVsbSkucGFyZW50cygnLnV4Y19jdXN0b21faW5wdXQnKTsKICAgICAgICAgICAgZWxtLmJpbmQoJ2tleXVwJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCQoZWxtKS52YWwoKSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICQoZWxtX3BhcmVudHMpLmFkZENsYXNzKCdmaWxsZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVsbS5iaW5kKCdmb2N1cycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoZWxtX3BhcmVudHMpLmFkZENsYXNzKCdmaWxsZWQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVsbS5iaW5kKCdmb2N1c291dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICgkKGVsbSkudmFsKCkgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkKGVsbV9wYXJlbnRzKS5hZGRDbGFzcygnZmlsbGVkJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQoZWxtX3BhcmVudHMpLnJlbW92ZUNsYXNzKCdmaWxsZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVsbS5iaW5kKCdibHVyJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCQoZWxtKS52YWwoKSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICQoZWxtX3BhcmVudHMpLmFkZENsYXNzKCdmaWxsZWQnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJChlbG1fcGFyZW50cykucmVtb3ZlQ2xhc3MoJ2ZpbGxlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0pOwoKYXBwLmRpcmVjdGl2ZSgndXhUZXN0Q2xpY2snLCBmdW5jdGlvbiAoJHVpYk1vZGFsLCAkcm9vdFNjb3BlLCAkY29uZmlnLCBQcmluY2lwYWwsIFRyYW5zbGF0aW9uLCAkaHR0cCkgewogICAgcmV0dXJuIHsKICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7CiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRycy5uZ0JpbmQsIGZ1bmN0aW9uIChuZXd2YWx1ZSkgewoKICAgICAgICAgICAgICAgIHZhciBzaG93TWVzc2FnZSA9IGZ1bmN0aW9uIChhbmltYXRpb24sIHNpemUsIHRlbXBsYXRlVXJsLCBzdHJpbmcsIHRpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGFuaW1hdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IHRlbXBsYXRlVXJsLAogICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc2NlLCAkdWliTW9kYWxJbnN0YW5jZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRleHRNU0cgPSAkc2NlLnRydXN0QXNIdG1sKHN0cmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGlkZVlFUyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGV4dE5PID0gVHJhbnNsYXRpb24udHJhbnNsYXRlKCdJTlQuSU5UMycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRpdGxlTW9kYWwgPSBUcmFuc2xhdGlvbi50cmFuc2xhdGUoJ0lOVC5JTlQ5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIGdldFRlc3RQYXNzU3RhdHNPYmplY3QgPSBmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBUZXN0UGFzc1N0YXRzID0gewogICAgICAgICAgICAgICAgICAgICAgICBvcmRlcklkOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnb3JkZXJJZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5OYW1lOiAnU1RBUlRfUExVR0lOJywKICAgICAgICAgICAgICAgICAgICAgICAgdGVzdGVySWQ6IGFjY291bnQuaWQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICB2YXIgZ2V0QWNjb3VudERhdGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgUHJpbmNpcGFsLmlkZW50aXR5KCkudGhlbihmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgJGh0dHAoewogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwaS9zdGF0cy9jcmVhdGUnLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBnZXRUZXN0UGFzc1N0YXRzT2JqZWN0KGFjY291bnQpLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UoVHJhbnNsYXRpb24uZ2V0RXh0ZW5zaW9uSWQoKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFBhZ2U6ICJzZXRCdG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlcklkOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnb3JkZXJJZCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0c0lkOiBkYXRhLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhzcmZUb2tlbjogZ2V0Q29va2llKCJYU1JGLVRPS0VOIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAob2JqKSB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NlbmRPcmRlcicpID09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgIGdldEFjY291bnREYXRhKCk7CgogICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdyZWxvYWRfcGFnZScsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2VuZE9yZGVyJywgZmFsc2UpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKFRyYW5zbGF0aW9uLmdldEV4dGVuc2lvbklkKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRQYWdlOiAicmVsb2FkX3BhZ2UiCiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3JkZXJJZCA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnR2V0IG1lc3NhZ2UgZnJvbSBleHRlbnNpb246ICcgKyBvYmopOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Nhbm5vdCBnZXQgYW4gZXh0ZW5zaW9uIG1lc3NhZ2UuIFBsZWFzZSwgZW5hYmxlIHlvdXIgZXh0ZW5zaW9uIScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKHRydWUsICdsZycsICcuLi8uLi90bXBsL3RtcGxfY3VzdG9tZXIvbW9kYWx0bXAuaHRtbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzx1bD48bGk+JyArIFRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnSU5ULklOVCcpICsgJzwvbGk+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsaT48YSBocmVmPSJodHRwczovL2Nocm9tZS5nb29nbGUuY29tL3dlYnN0b3JlL2RldGFpbC91eGNyb3dkLycgKyBUcmFuc2xhdGlvbi5nZXRFeHRlbnNpb25JZCgpICsgJyIgdGFyZ2V0PSJfYmxhbmsiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3R5bGU9Im1hcmdpbi1yaWdodDogMTBweDsiIHNyYz0iLi4vYXNzZXRzL2ltYWdlcy9kb3dubG9hZC1hcnIucG5nIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0icHJlc2VudGF0aW9uLWxpbmsiPicgKyBUcmFuc2xhdGlvbi50cmFuc2xhdGUoJ0lOVC5JTlQxJykgKyAnPC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPiAoJyArIFRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnSU5ULklOVDInKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyk8L2xpPjwvdWw+Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuaHJlZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJJZCA9IGUudGFyZ2V0LmhyZWYuc3BsaXQoJz0nKVsxXQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJJZCA9IGVsZW1lbnQucGFyZW50KCkuYXR0cignYWN0aW9uJykuc3BsaXQoJz0nKVsxXQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnb3JkZXJJZCcsIG9yZGVySWQpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncmVsb2FkX3BhZ2UnLCBvYmoucmVsb2FkX3BhZ2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHV4Y19jaHJvbWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uSW5zdGFsbGVkID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uVmVyc2lvbjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXF1ZXN0IGV4dGVuc2lvbiBtYW5pZmVzdC5qc29uIGZpbGUgYW5kIHJlYWQgZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdjaHJvbWUtZXh0ZW5zaW9uOi8vJyArIFRyYW5zbGF0aW9uLmdldEV4dGVuc2lvbklkKCkgKyAnL21hbmlmZXN0Lmpzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblZlcnNpb24gPSBqc29uLnZlcnNpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbkluc3RhbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncmVsb2FkX3BhZ2UnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXh0ZW5zaW9uSW5zdGFsbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RWZXJzaW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHdpbmRvdy4kY29uZmlnLmZ1bGxVcmwgKyAiL2FwaS92Mi9wbHVnaW4vZ2V0TGFzdFZlcnNpb24/cGx1Z2luVHlwZT1XRUImZW52aXJvbm1lbnRUeXBlPSIrd2luZG93LiRjb25maWcuZW52aXJvbm1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RWZXJzaW9uID0ganNvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4dGVuc2lvblZlcnNpb24gPj0gbGFzdFZlcnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyZWxvYWRfcGFnZScpID09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ29yZGVySWQnLCBvcmRlcklkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzZW5kT3JkZXInLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjY291bnREYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBOb3RpY2UgYWJvdXQgb2xkIGV4dGVuc2lvbiB2ZXJzaW9uLiBQbGVhc2UsIHVwZGF0ZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UodHJ1ZSwgJ2xnJywgJy4uLy4uL3RtcGwvdG1wbF9jdXN0b21lci9tb2RhbHRtcC5odG1sJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8dWw+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsaT4nICsgVHJhbnNsYXRpb24udHJhbnNsYXRlKCdJTlQuSU5UNScpICsgJzwvbGk+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGxpPicgKyBUcmFuc2xhdGlvbi50cmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSU5ULklOVDYnKSArICcgLSAnICsgbGFzdFZlcnNpb24gKyAnPC9saT4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3VsPicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gRXh0ZW5zaW9uIGRpc2FibGVkIG9yIG5vdCBpbnN0YWxsZWQgdG8gQ2hyb21lLiBTaG93IG1lc3NhZ2UgYW5kIGxpbmsgdG8gZG93bmxvYWQgZXh0ZW5zaW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UodHJ1ZSwgJ2xnJywgJy4uLy4uL3RtcGwvdG1wbF9jdXN0b21lci9tb2RhbHRtcC5odG1sJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzx1bD48bGk+JyArIFRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnSU5ULklOVCcpICsgJzwvbGk+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8bGk+PGEgaHJlZj0iaHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvdXhjcm93ZC8nICsgVHJhbnNsYXRpb24uZ2V0RXh0ZW5zaW9uSWQoKSArICciIHRhcmdldD0iX2JsYW5rIj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGltZyBzdHlsZT0ibWFyZ2luLXJpZ2h0OiAxMHB4OyIgc3JjPSIuLi9hc3NldHMvaW1hZ2VzL2Rvd25sb2FkLWFyci5wbmciPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0icHJlc2VudGF0aW9uLWxpbmsiPicgKyBUcmFuc2xhdGlvbi50cmFuc2xhdGUoJ0lOVC5JTlQxJykgKyAnPC9zcGFuPiApJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9hPiAoJyArIFRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnSU5ULklOVDInKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2xpPjwvdWw+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIFdoZW4gdXNlIGFub3RoZXIgYnJvd3Nlciwgbm90IENocm9tZS4gU2hvdyBtZXNzYWdlIGFuZCBsaW5rIHRvIGRvd25sb2FkIENocm9tZSBicm93c2VyLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKHRydWUsICdsZycsICcuLi8uLi90bXBsL3RtcGxfY3VzdG9tZXIvbW9kYWx0bXBmdWxsLmh0bWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0idGV4dF9lcnJvcl9tb2RhbCI+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgnSU5ULklOVDcnKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9InRleHRfZXJyb3JfbW9kYWwiPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbi50cmFuc2xhdGUoJ0lOVC5JTlQ4JykgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSJodHRwczovL3d3dy5nb29nbGUuY29tL2Nocm9tZS9icm93c2VyL2Rlc2t0b3AvaW5kZXguaHRtbCI+Q2hyb21lPC9hPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3NwYW4+JywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoJ2h5cGVyQ29tbWVudHNXaWRnZXQnLCBmdW5jdGlvbiAoVmlkZW8sIFByaW5jaXBhbCkgewogICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICB3aWRnZXQ6ICJTdHJlYW0iLCB3aWRnZXRfaWQ6IDg2NDQ1LCBjYWxsYmFjazogZnVuY3Rpb24gKGV2ZW50LCBpbml0KSB7CiAgICAgICAgICAgIGV2ZW50Lm9uKCdzdHJlYW1NZXNzYWdlJywgZnVuY3Rpb24gKHBhY2tldCkgewogICAgICAgICAgICAgICAgaWYgKHBhY2tldC5pc19yZXNwKSB7CiAgICAgICAgICAgICAgICAgICAgVmlkZW8udmlkZW9DcmVhdGVkQ29tbWVudChwYWNrZXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gJCgnLmJsb2ctZW5kLWNvbW1lbnRzLWNvdW50JykudGV4dChldmVudC5jb25maWcuY29tbWVudHNfbGV2ZWwpOwogICAgICAgIH0KICAgIH07CiAgICByZXR1cm4gewogICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHsKICAgICAgICAgICAgUHJpbmNpcGFsLmlkZW50aXR5KCkudGhlbihmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgICAgICAgICAgaWYgKGFjY291bnQuaHlwZXJDb21tZW50c0F1dGggIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBhcmFtcy5hdXRoID0gYWNjb3VudC5oeXBlckNvbW1lbnRzQXV0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiBmaW5hbGx5Q2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBfaGN3cCA9IFtdOwogICAgICAgICAgICAgICAgX2hjd3AucHVzaChwYXJhbXMpOwogICAgICAgICAgICAgICAgX2hjd3AucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiAiQmxvZ2dlcnN0cmVhbSIsCiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0X2lkOiA4NjQ0NSwKICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcjogIi5ub2RlX2NvbW1lbnRfY291bnQiLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAieyVDT1VOVCV9IgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBsYW5nID0gKG5hdmlnYXRvci5sYW5ndWFnZSB8fCBuYXZpZ2F0b3Iuc3lzdGVtTGFuZ3VhZ2UgfHwgbmF2aWdhdG9yLnVzZXJMYW5ndWFnZSB8fCAiZW4iKS5zdWJzdHIoMCwgMikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaGNjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgICAgICAgICAgICAgaGNjLnR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IjsKICAgICAgICAgICAgICAgICAgICBoY2MuYXN5bmMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGhjYy5zcmMgPSAoImh0dHBzOiIgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAiaHR0cHMiIDogImh0dHAiKSArICI6Ly93Lmh5cGVyY29tbWVudHMuY29tL3dpZGdldC9oYy84NjQ0NS8iICsgbGFuZyArICIvd2lkZ2V0LmpzIjsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKVswXTsKICAgICAgICAgICAgICAgICAgICBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGhjYywgcy5uZXh0U2libGluZyk7CiAgICAgICAgICAgICAgICB9KSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoJ2N1c3RvbXRpdGxlJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsbSwgYXR0cnMsIGN0cmwpIHsKICAgICAgICAgICAgZWxtLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJChlbG0pLnBhcmVudHMoJy51eGNfY3VzdG9tX2lucHV0JykuZmluZCgnaW5wdXQnKS5mb2N1cygpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0pOwoKYXBwLmRpcmVjdGl2ZSgnc2xpZGVyJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsbSwgYXR0cnMsIGN0cmwpIHsKICAgICAgICAgICAgdmFyIGVsVmFsdWUgPSBzY29wZS5vcmRlci50aGVpclRlc3RlcnNDb3VudDsKICAgICAgICAgICAgZWxtLnNsaWRlcih7CiAgICAgICAgICAgICAgICByYW5nZTogIm1pbiIsCiAgICAgICAgICAgICAgICBtYXg6IDIwLAogICAgICAgICAgICAgICAgbWluOiAxLAogICAgICAgICAgICAgICAgc3RlcDogMSwKICAgICAgICAgICAgICAgIHZhbHVlOiBlbFZhbHVlLAogICAgICAgICAgICAgICAgc2xpZGU6IGZ1bmN0aW9uIChldmVudCwgdWkpIHsKICAgICAgICAgICAgICAgICAgICBzY29wZS5vcmRlci50aGVpclRlc3RlcnNDb3VudCA9IHVpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH0KfSk7CgphcHAuZGlyZWN0aXZlKCdwYXJ0aWNpcGFudEdyb3VwJywgZnVuY3Rpb24gKCkgewogICAgcmVzdHJpY3Q6ICdFJzsKICAgIHJldHVybiB7CiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIHZhciBzbGlkZXIgPSAkKGVsbS5maW5kKCcuY291bnRfc2xpZGVyJylbMF0pOwogICAgICAgICAgICB2YXIgZWxWYWx1ZSA9IHNjb3BlLnBhcnRpY2lwYW50R3JvdXAuY291bnQ7CiAgICAgICAgICAgIHNsaWRlci5zbGlkZXIoewogICAgICAgICAgICAgICAgcmFuZ2U6ICJtaW4iLAogICAgICAgICAgICAgICAgbWF4OiAxMCwKICAgICAgICAgICAgICAgIG1pbjogMSwKICAgICAgICAgICAgICAgIHN0ZXA6IDEsCiAgICAgICAgICAgICAgICB2YWx1ZTogZWxWYWx1ZSwKICAgICAgICAgICAgICAgIHNsaWRlOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFydGljaXBhbnRHcm91cC5jb3VudCA9IHVpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBpbmNvbWUgPSAkKGVsbS5maW5kKCcuaW5jb21lJylbMF0pOwogICAgICAgICAgICB2YXIgZWxWYWx1ZU1pbiA9ICBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLmhvdXNlaG9sZEluY29tZU1pbjsKICAgICAgICAgICAgdmFyIGVsVmFsdWVNYXggPSBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLmhvdXNlaG9sZEluY29tZU1heDsKICAgICAgICAgICAgaWYgKGVsVmFsdWVNYXggPT0gIjUwIDAwMCsiIHx8IGVsVmFsdWVNYXggPiA1MDAwMCkgewogICAgICAgICAgICAgICAgZWxWYWx1ZU1heCA9IDU1MDAwOwogICAgICAgICAgICAgICAgaW5jb21lLnBhcmVudHMoJy5pdGVtX2xpc3RfZ3JvdXAnKS5zY29wZSgpLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWF4ID0gJzUwIDAwMCsnOwoKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmNvbWUuc2xpZGVyKHsKICAgICAgICAgICAgICAgIHJhbmdlOiB0cnVlLAogICAgICAgICAgICAgICAgbWluOiAwLAogICAgICAgICAgICAgICAgbWF4OiA1NTAwMCwKICAgICAgICAgICAgICAgIHN0ZXA6IDUwMDAsCiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtlbFZhbHVlTWluLCBlbFZhbHVlTWF4XSwKICAgICAgICAgICAgICAgIHNsaWRlOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVpLnZhbHVlc1swXSA9PSB1aS52YWx1ZXNbMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpbmNvbWUucGFyZW50cygnLml0ZW1fbGlzdF9ncm91cCcpLnNjb3BlKCkucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNaW4gPSB1aS52YWx1ZXNbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKHVpLnZhbHVlc1sxXSA9PSA1NTAwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbmNvbWUucGFyZW50cygnLml0ZW1fbGlzdF9ncm91cCcpLnNjb3BlKCkucGFydGljaXBhbnRHcm91cC5ob3VzZWhvbGRJbmNvbWVNYXggPSAnNTAgMDAwKyc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5jb21lLnBhcmVudHMoJy5pdGVtX2xpc3RfZ3JvdXAnKS5zY29wZSgpLnBhcnRpY2lwYW50R3JvdXAuaG91c2Vob2xkSW5jb21lTWF4ID0gdWkudmFsdWVzWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgYWdlID0gJChlbG0uZmluZCgnLmFnZScpWzBdKTsKICAgICAgICAgICAgdmFyIGVsVmFsdWVNaW4gPSBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1pbkFnZTsKICAgICAgICAgICAgdmFyIGVsVmFsdWVNYXggPSBzY29wZS5wYXJ0aWNpcGFudEdyb3VwLm1heEFnZTsKICAgICAgICAgICBpZiAoZWxWYWx1ZU1heCA9PSAiNjArIiB8fCBlbFZhbHVlTWF4ID09IDYxKSB7CiAgICAgICAgICAgICAgIGVsVmFsdWVNYXggPSA2MTsKICAgICAgICAgICAgICAgIGFnZS5wYXJlbnRzKCcuaXRlbV9saXN0X2dyb3VwJykuc2NvcGUoKS5wYXJ0aWNpcGFudEdyb3VwLm1heEFnZSA9ICc2MCsnOwogICAgICAgICAgIH0KICAgICAgICAgIGFnZS5zbGlkZXIoewogICAgICAgICAgICAgIHJhbmdlOiB0cnVlLAogICAgICAgICAgICAgIG1pbjogMTgsCiAgICAgICAgICAgICAgbWF4OiA2MSwKICAgICAgICAgICAgICBzdGVwOiAxLAogICAgICAgICAgICAgIHZhbHVlczogW2VsVmFsdWVNaW4sIGVsVmFsdWVNYXhdLAogICAgICAgICAgICAgIHNsaWRlOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7CiAgICAgICAgICAgICAgICAgIGlmICh1aS52YWx1ZXNbMF0gPT0gdWkudmFsdWVzWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYWdlLnBhcmVudHMoJy5pdGVtX2xpc3RfZ3JvdXAnKS5zY29wZSgpLnBhcnRpY2lwYW50R3JvdXAubWluQWdlID0gdWkudmFsdWVzWzBdOwogICAgICAgICAgICAgICAgICBpZiAodWkudmFsdWVzWzFdID09IDYxKSB7CiAgICAgICAgICAgICAgICAgICAgICBhZ2UucGFyZW50cygnLml0ZW1fbGlzdF9ncm91cCcpLnNjb3BlKCkucGFydGljaXBhbnRHcm91cC5tYXhBZ2UgPSAnNjArJzsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGFnZS5wYXJlbnRzKCcuaXRlbV9saXN0X2dyb3VwJykuc2NvcGUoKS5wYXJ0aWNpcGFudEdyb3VwLm1heEFnZSA9IHVpLnZhbHVlc1sxXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzZWxlY3RvckVsID0gZWxtLmZpbmQoJy5oZWFkZXJfaXRlbV9leHBhbmRfYmxvY2snKTsKICAgICAgICAgICAgJChzZWxlY3RvckVsKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQodGhpcykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLnBhcmVudHMoJy5pdGVtX2V4YW1wbGVfc3RyaW5nJykuaGFzQ2xhc3MoJ29wZW4nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXRlbV9leGFtcGxlX3N0cmluZycpLnJlbW92ZUNsYXNzKCdvcGVuJyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLml0ZW1fZXhhbXBsZV9zdHJpbmcnKS5yZW1vdmVDbGFzcygnb3BlbicpOwogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoJy5pdGVtX2V4YW1wbGVfc3RyaW5nJykuYWRkQ2xhc3MoJ29wZW4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgfQp9KTsKCmFwcC5kaXJlY3RpdmUoJ3dlYmZsb3cnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgY3RybCkgewogICAgICAgICAgICBpZiAodHlwZW9mIFdlYmZsb3cgIT09ICd1bmRlZmluZWQnKXsKICAgICAgICAgICAgICAgIFdlYmZsb3cuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgV2ViZmxvdy5yZWFkeSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJC5nZXRTY3JpcHQoICJhc3NldHMvanMvbGFuZGluZy93ZWJmbG93LmpzIiwgZnVuY3Rpb24oIGRhdGEsIHRleHRTdGF0dXMsIGpxeGhyICkgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggIkxvYWQgd2FzIHBlcmZvcm1lZC4iICk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfSk7CgphcHAuZGlyZWN0aXZlKCdzb2NpYWxOZXR3b3JrJywgZnVuY3Rpb24gKCR0aW1lb3V0KSB7CiAgICByZXR1cm4gewogICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgY3RybCkgewogICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdUxvZ2luLmN1c3RvbUluaXQoJChlbG0pLmF0dHIoJ2lkJykpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfSk7CgphcHAuZGlyZWN0aXZlKCdmb2N1c291dCcsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIGVsbS5iaW5kKCdmb2N1c291dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLnZhbCgpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICQoJ2xhYmVsW2Zvcj0iJyArICQodGhpcykuYXR0cignaWQnKSArICciXScpLnJlbW92ZUNsYXNzKCdsYWJlbC0tdXAnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJCgnbGFiZWxbZm9yPSInICsgJCh0aGlzKS5hdHRyKCdpZCcpICsgJyJdJykuYWRkQ2xhc3MoJ2xhYmVsLS11cCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0pOwoKYXBwLmRpcmVjdGl2ZSgnc2hhcmluZycsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIFNoYXJlID0gewogICAgICAgICAgICAgICAgdmtvbnRha3RlOiBmdW5jdGlvbiAocHVybCwgcHRpdGxlLCBwaW1nLCB0ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gJ2h0dHA6Ly92a29udGFrdGUucnUvc2hhcmUucGhwPyc7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICd1cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudChwdXJsKTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZ0aXRsZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHB0aXRsZSk7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmZGVzY3JpcHRpb249JyArIGVuY29kZVVSSUNvbXBvbmVudCh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZpbWFnZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHBpbWcpOwogICAgICAgICAgICAgICAgICAgIHVybCArPSAnJm5vcGFyc2U9dHJ1ZSc7CiAgICAgICAgICAgICAgICAgICAgU2hhcmUucG9wdXAodXJsKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvZG5va2xhc3NuaWtpOiBmdW5jdGlvbiAocHVybCwgdGV4dCkgewogICAgICAgICAgICAgICAgICAgIHVybCA9ICdodHRwOi8vd3d3Lm9kbm9rbGFzc25pa2kucnUvZGs/c3QuY21kPWFkZFNoYXJlJnN0LnM9MSc7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmc3QuY29tbWVudHM9JyArIGVuY29kZVVSSUNvbXBvbmVudCh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZzdC5fc3VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHB1cmwpOwogICAgICAgICAgICAgICAgICAgIFNoYXJlLnBvcHVwKHVybCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZmFjZWJvb2s6IGZ1bmN0aW9uIChwdXJsLCBwdGl0bGUsIHBpbWcsIHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB1cmwgPSAnaHR0cDovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyLnBocD9zPTEwMCc7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmcFt0aXRsZV09JyArIGVuY29kZVVSSUNvbXBvbmVudChwdGl0bGUpOwogICAgICAgICAgICAgICAgICAgIHVybCArPSAnJnBbc3VtbWFyeV09JyArIGVuY29kZVVSSUNvbXBvbmVudCh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZwW3VybF09JyArIGVuY29kZVVSSUNvbXBvbmVudChwdXJsKTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZwW2ltYWdlc11bMF09JyArIGVuY29kZVVSSUNvbXBvbmVudChwaW1nKTsKICAgICAgICAgICAgICAgICAgICBTaGFyZS5wb3B1cCh1cmwpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHR3aXR0ZXI6IGZ1bmN0aW9uIChwdXJsLCBwdGl0bGUpIHsKICAgICAgICAgICAgICAgICAgICB1cmwgPSAnaHR0cDovL3R3aXR0ZXIuY29tL3NoYXJlPyc7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICd0ZXh0PScgKyBlbmNvZGVVUklDb21wb25lbnQocHRpdGxlKTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZ1cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudChwdXJsKTsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gJyZjb3VudHVybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHB1cmwpOwogICAgICAgICAgICAgICAgICAgIFNoYXJlLnBvcHVwKHVybCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcG9wdXA6IGZ1bmN0aW9uICh1cmwpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICcnLCAndG9vbGJhcj0wLHN0YXR1cz0wLHdpZHRoPTYyNixoZWlnaHQ9NDM2Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgcGF0aFBvc3RlciwKICAgICAgICAgICAgICAgIE5FV1NIRVJFVElUTEUsCiAgICAgICAgICAgICAgICBTSEVSRURFU0NSSVBUSU9OLAogICAgICAgICAgICAgICAgU0hBUkVVUkw7CiAgICAgICAgICAgIGlmIChlbG0uaGFzQ2xhc3MoJ29kX2ltZycpKXsKICAgICAgICAgICAgICAgICQoZWxtKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcGF0aFBvc3RlciA9ICQoZWxtKS5wYXJlbnQoKS5kYXRhKCdwYXRoc2hhcmluZycpOwogICAgICAgICAgICAgICAgICAgIE5FV1NIRVJFVElUTEUgPSAkKGVsbSkucGFyZW50KCkuZGF0YSgndGl0bGVzaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU0hFUkVERVNDUklQVElPTiA9ICQoZWxtKS5wYXJlbnQoKS5kYXRhKCdkZXNjcmlwdGlvbnNoYXJpbmcnKTsKICAgICAgICAgICAgICAgICAgICBTSEFSRVVSTCA9ICRjb25maWcuZnVsbFVybCArICQoZWxtKS5wYXJlbnQoKS5kYXRhKCd1cmxzaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU2hhcmUub2Rub2tsYXNzbmlraShTSEFSRVVSTCwgU0hFUkVERVNDUklQVElPTikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbG0uaGFzQ2xhc3MoJ2ZiX2ltZycpKXsKICAgICAgICAgICAgICAgICQoZWxtKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcGF0aFBvc3RlciA9ICQoZWxtKS5wYXJlbnQoKS5kYXRhKCdwYXRoc2hhcmluZycpOwogICAgICAgICAgICAgICAgICAgIE5FV1NIRVJFVElUTEUgPSAkKGVsbSkucGFyZW50KCkuZGF0YSgndGl0bGVzaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU0hFUkVERVNDUklQVElPTiA9ICQoZWxtKS5wYXJlbnQoKS5kYXRhKCdkZXNjcmlwdGlvbnNoYXJpbmcnKTsKICAgICAgICAgICAgICAgICAgICBTSEFSRVVSTCA9ICRjb25maWcuZnVsbFVybCArICQoZWxtKS5wYXJlbnQoKS5kYXRhKCd1cmxzaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU2hhcmUuZmFjZWJvb2soU0hBUkVVUkwsIE5FV1NIRVJFVElUTEUsIHBhdGhQb3N0ZXIsIFNIRVJFREVTQ1JJUFRJT04pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWxtLmhhc0NsYXNzKCd2a19pbWcnKSl7CiAgICAgICAgICAgICAgICAkKGVsbSkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHBhdGhQb3N0ZXIgPSAkKGVsbSkucGFyZW50KCkuZGF0YSgncGF0aHNoYXJpbmcnKTsKICAgICAgICAgICAgICAgICAgICBORVdTSEVSRVRJVExFID0gJChlbG0pLnBhcmVudCgpLmRhdGEoJ3RpdGxlc2hhcmluZycpOwogICAgICAgICAgICAgICAgICAgIFNIRVJFREVTQ1JJUFRJT04gPSAkKGVsbSkucGFyZW50KCkuZGF0YSgnZGVzY3JpcHRpb25zaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU0hBUkVVUkwgPSAkY29uZmlnLmZ1bGxVcmwgKyAkKGVsbSkucGFyZW50KCkuZGF0YSgndXJsc2hhcmluZycpOwogICAgICAgICAgICAgICAgICAgIFNoYXJlLnZrb250YWt0ZShTSEFSRVVSTCwgTkVXU0hFUkVUSVRMRSwgcGF0aFBvc3RlciwgU0hFUkVERVNDUklQVElPTikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbG0uaGFzQ2xhc3MoJ3R3X2ltZycpKXsKICAgICAgICAgICAgICAgICQoZWxtKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcGF0aFBvc3RlciA9ICQoZWxtKS5wYXJlbnQoKS5kYXRhKCdwYXRoc2hhcmluZycpOwogICAgICAgICAgICAgICAgICAgIE5FV1NIRVJFVElUTEUgPSAkKGVsbSkucGFyZW50KCkuZGF0YSgndGl0bGVzaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU0hFUkVERVNDUklQVElPTiA9ICQoZWxtKS5wYXJlbnQoKS5kYXRhKCdkZXNjcmlwdGlvbnNoYXJpbmcnKTsKICAgICAgICAgICAgICAgICAgICBTSEFSRVVSTCA9ICRjb25maWcuZnVsbFVybCArICQoZWxtKS5wYXJlbnQoKS5kYXRhKCd1cmxzaGFyaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgU2hhcmUudHdpdHRlcihTSEFSRVVSTCwgTkVXU0hFUkVUSVRMRSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWxtLmhhc0NsYXNzKCdjb3B5X2ltZycpKXsKICAgICAgICAgICAgICAgICQoZWxtKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0ICE9PSB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGlmICgkKGVsbSkuZmluZCgnI2Jsb2NrX2NvcHlfaW1nJykuaGFzQ2xhc3MoJ29wZW4nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkuZmluZCgnI2Jsb2NrX2NvcHlfaW1nJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkuZmluZCgnI2Jsb2NrX2NvcHlfaW1nJykuYWRkQ2xhc3MoJ29wZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8kKGVsbSkudW5iaW5kKCAiY2xpY2siICk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxtKS5maW5kKCIuYnRuX2NvcHlfZnVsbF9ocmVmIikuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkdGVtcCA9ICQoIjxpbnB1dD4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoImJvZHkiKS5hcHBlbmQoJHRlbXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRlbXAudmFsKCQoZWxtKS5maW5kKCIjaW5zaWdodC1mdWxsLWhyZWYiKS52YWwoKSkuc2VsZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgiY29weSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRlbXAucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkuZmluZCgnI2Jsb2NrX2NvcHlfaW1nJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0pOwoKYXBwLmRpcmVjdGl2ZSgnc2hvd1RhYicsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykgewogICAgICAgICAgICBlbGVtZW50LmNsaWNrKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBqUXVlcnkoZWxlbWVudCkudGFiKCdzaG93Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07Cn0pOwoKYXBwLmRpcmVjdGl2ZSgncG9wT3ZlcicsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykgewogICAgICAgICAgICAkKGVsZW1lbnQpLnBvcG92ZXIoKTsKICAgICAgICB9CiAgICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoJ3Rlc3RlclVwbG9hZFZpZGVvJywgZnVuY3Rpb24gKFByaW5jaXBhbCwgVHJhbnNsYXRpb24pIHsKICAgIHZhciBwcmluY2lwYWwgPSBudWxsOwogICAgUHJpbmNpcGFsLmlkZW50aXR5KCkudGhlbihmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgIHByaW5jaXBhbCA9IGFjY291bnQ7CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykgewogICAgICAgICAgICAgICAgc2NvcGUudHJhbnNsYXRpb24gPSBUcmFuc2xhdGlvbjsKICAgICAgICAgICAgICAgIHZhciBnZXRDU1JGID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gJ1hTUkYtVE9LRU49JzsKICAgICAgICAgICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gY2FbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PSAnICcpIGMgPSBjLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuaW5kZXhPZihuYW1lKSAhPSAtMSkgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWUubGVuZ3RoLCBjLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQoZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgdmFyICRkaXYgPSAgJHRoaXMuc2libGluZ3MoKTsKICAgICAgICAgICAgICAgICB2YXIgJGxhYmVsID0gJHRoaXMuY2xvc2VzdCgnbGFiZWwnKTsKICAgICAgICAgICAgICAgICB2YXIgJGRpdlByb2dyZXNzID0gJGRpdi5maW5kKCdkaXYnKTsKICAgICAgICAgICAgICAgICB2YXIgJHNwYW4gPSAkZGl2LmZpbmQoJ3NwYW4nKTsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVGaWxlU2VsZWN0KGV2dCkgewogICAgICAgICAgICAgICAgICAgICRzcGFuLnRleHQoc2NvcGUudHJhbnNsYXRpb24udHJhbnNsYXRlKCJJTlQuSU5UMTAiKSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMucHJvcCgnZGlzYWJsZWQnLHRydWUpOwogICAgICAgICAgICAgICAgICAgICRsYWJlbC5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgJGRpdi5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBmaWxlcyA9IGV2dC50YXJnZXQuZmlsZXM7CiAgICAgICAgICAgICAgICAgICAgZiA9IGZpbGVzWzBdOwogICAgICAgICAgICAgICAgICAgIGlmKGYuc2l6ZSA+IDEwMDAgKiAxMDI0ICogMTAyNCAqIDIpey8vINCx0L7Qu9GM0YjQtSAyR2IKICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDMwIikpOwogICAgICAgICAgICAgICAgICAgICAgJHRoaXMucHJvcCgnZGlzYWJsZWQnLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICRsYWJlbC5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgJGRpdi5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgJHNwYW4udGV4dChzY29wZS50cmFuc2xhdGlvbi50cmFuc2xhdGUoIklOVC5JTlQxMiIpKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGVzY2FwZShmLm5hbWUpLnNwbGl0KCcuJykucG9wKCkhPSd3ZWJtJyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDExIikpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAkbGFiZWwucHJvcCgnZGlzYWJsZWQnLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpdi5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAkc3Bhbi50ZXh0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDEyIikpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkc3Bhbi50ZXh0KCIwJSIpOwogICAgICAgICAgICAgICAgICAgICAgICAkZGl2UHJvZ3Jlc3MuaGVpZ2h0KDgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJyYXlCdWZmZXIgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlVHlwZSA9ICQoJyNmaWxlLXR5cGUnKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvYlV0aWwuYXJyYXlCdWZmZXJUb0Jsb2IoYXJyYXlCdWZmZXIsIGZpbGVUeXBlKS50aGVuKGZ1bmN0aW9uIChibG9iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnb3JkZXJJZCcsICR0aGlzLmF0dHIoICdvcmRlcklkJyApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGJsb2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCduYW1lJywgJ2Jsb2Iud2VibScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSBNYXRoLmZsb29yKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsICogMTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGVyY2VudD4xKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudCA9IHBlcmNlbnQgLSAxIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpdlByb2dyZXNzLndpZHRoKCBwZXJjZW50KyclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwYW4udGV4dCggcGVyY2VudCArJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIub3BlbigiUE9TVCIsICcvYXBpL2xrLXZpZGVvLXVwbG9hZC1hcHAnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVhTUkYtVE9LRU4nLCBnZXRDU1JGKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gWE1MSHR0cFJlcXVlc3QuRE9ORSAmJiB4aHIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpdlByb2dyZXNzLndpZHRoKCcxMDAlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFuLnRleHQoJzEwMCUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoc2NvcGUudHJhbnNsYXRpb24udHJhbnNsYXRlKCJJTlQuSU5UMTMiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDE0IikrIiAiK3hoci5zdGF0dXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGl2UHJvZ3Jlc3MuaGVpZ2h0KDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGl2UHJvZ3Jlc3Mud2lkdGgoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnByb3AoJ2Rpc2FibGVkJyxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsYWJlbC5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGl2LnByb3AoJ2Rpc2FibGVkJyxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFuLnRleHQoc2NvcGUudHJhbnNsYXRpb24udHJhbnNsYXRlKCJJTlQuSU5UMTUiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzWzBdLnZhbHVlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZChmb3JtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkpOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLmNoYW5nZShoYW5kbGVGaWxlU2VsZWN0KTsKICAgICAgICB9CiAgICB9Owp9KTsKCmFwcC5kaXJlY3RpdmUoJ2FkbWluVXBsb2FkVmlkZW8nLCBmdW5jdGlvbiAoUHJpbmNpcGFsLCBUcmFuc2xhdGlvbikgewogICAgdmFyIHByaW5jaXBhbCA9IG51bGw7CiAgICBQcmluY2lwYWwuaWRlbnRpdHkoKS50aGVuKGZ1bmN0aW9uIChhY2NvdW50KSB7CiAgICAgICAgcHJpbmNpcGFsID0gYWNjb3VudDsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgc2NvcGUudHJhbnNsYXRpb24gPSBUcmFuc2xhdGlvbjsKICAgICAgICAgICAgdmFyIGdldENTUkYgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9ICdYU1JGLVRPS0VOPSc7CiAgICAgICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2EubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGNhW2ldOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PSAnICcpIGMgPSBjLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWUpICE9IC0xKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZS5sZW5ndGgsIGMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQoZWxlbWVudCk7CiAgICAgICAgICAgIHZhciAkZGl2ID0gICR0aGlzLnNpYmxpbmdzKCk7CiAgICAgICAgICAgIHZhciAkbGFiZWwgPSAkdGhpcy5jbG9zZXN0KCdsYWJlbCcpOwogICAgICAgICAgICB2YXIgJGRpdlByb2dyZXNzID0gJGRpdi5maW5kKCdkaXYnKTsKICAgICAgICAgICAgdmFyICRzcGFuID0gJGRpdi5maW5kKCdzcGFuJyk7CgogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVGaWxlU2VsZWN0KGV2dCkgewogICAgICAgICAgICAgICAgJHNwYW4udGV4dChzY29wZS50cmFuc2xhdGlvbi50cmFuc2xhdGUoIklOVC5JTlQxMCIpKTsKICAgICAgICAgICAgICAgICR0aGlzLnByb3AoJ2Rpc2FibGVkJyx0cnVlKTsKICAgICAgICAgICAgICAgICRsYWJlbC5wcm9wKCdkaXNhYmxlZCcsdHJ1ZSk7CiAgICAgICAgICAgICAgICAkZGl2LnByb3AoJ2Rpc2FibGVkJyx0cnVlKTsKCiAgICAgICAgICAgICAgICB2YXIgZmlsZXMgPSBldnQudGFyZ2V0LmZpbGVzOwogICAgICAgICAgICAgICAgZiA9IGZpbGVzWzBdOwogICAgICAgICAgICAgICAgaWYoZi5zaXplID4gMTAwMCAqIDEwMjQgKiAxMDI0ICogMil7Ly8g0LHQvtC70YzRiNC1IDJHYgogICAgICAgICAgICAgICAgICAgIGFsZXJ0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDMwIikpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLnByb3AoJ2Rpc2FibGVkJyxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgJGxhYmVsLnByb3AoJ2Rpc2FibGVkJyxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgJGRpdi5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICRzcGFuLnRleHQoc2NvcGUudHJhbnNsYXRpb24udHJhbnNsYXRlKCJJTlQuSU5UMTIiKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGVzY2FwZShmLm5hbWUpLnNwbGl0KCcuJykucG9wKCkhPSd3ZWJtJyl7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoc2NvcGUudHJhbnNsYXRpb24udHJhbnNsYXRlKCJJTlQuSU5UMTEiKSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMucHJvcCgnZGlzYWJsZWQnLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAkbGFiZWwucHJvcCgnZGlzYWJsZWQnLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAkZGl2LnByb3AoJ2Rpc2FibGVkJyxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgJHNwYW4udGV4dChzY29wZS50cmFuc2xhdGlvbi50cmFuc2xhdGUoIklOVC5JTlQxMiIpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICRzcGFuLnRleHQoIjAlIik7CiAgICAgICAgICAgICAgICAgICAgJGRpdlByb2dyZXNzLmhlaWdodCg4KTsKICAgICAgICAgICAgICAgICAgICB2YXIgYXJyYXlCdWZmZXIgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVUeXBlID0gJCgnI2ZpbGUtdHlwZScpLnZhbCgpOwogICAgICAgICAgICAgICAgICAgIGJsb2JVdGlsLmFycmF5QnVmZmVyVG9CbG9iKGFycmF5QnVmZmVyLCBmaWxlVHlwZSkudGhlbihmdW5jdGlvbiAoYmxvYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdvcmRlcklkJywgJCgnI29yZGVySWQnKS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgndGVzdGVyRW1haWwnLCAkKCcjdGVzdGVyRW1haWwnKS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGJsb2IpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ25hbWUnLCAnYmxvYi53ZWJtJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudCA9IE1hdGguZmxvb3IoZXZlbnQubG9hZGVkIC8gZXZlbnQudG90YWwgKiAxMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBlcmNlbnQ+MSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudCA9IHBlcmNlbnQgLSAxIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXZQcm9ncmVzcy53aWR0aCggcGVyY2VudCsnJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwYW4udGV4dCggcGVyY2VudCArJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9wZW4oIlBPU1QiLCAnL2FwaS92Mi9hZG1pbi9say12aWRlby11cGxvYWQtYXBwJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVhTUkYtVE9LRU4nLCBnZXRDU1JGKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB4aHIub25sb2FkZW5kID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IFhNTEh0dHBSZXF1ZXN0LkRPTkUgJiYgeGhyLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpdlByb2dyZXNzLndpZHRoKCcxMDAlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwYW4udGV4dCgnMTAwJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDEzIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChzY29wZS50cmFuc2xhdGlvbi50cmFuc2xhdGUoIklOVC5JTlQxNCIpKyIgIit4aHIuc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGl2UHJvZ3Jlc3MuaGVpZ2h0KDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXZQcm9ncmVzcy53aWR0aCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsYWJlbC5wcm9wKCdkaXNhYmxlZCcsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXYucHJvcCgnZGlzYWJsZWQnLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3Bhbi50ZXh0KHNjb3BlLnRyYW5zbGF0aW9uLnRyYW5zbGF0ZSgiSU5ULklOVDE1IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzWzBdLnZhbHVlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZChmb3JtRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goY29uc29sZS5sb2cuYmluZChjb25zb2xlKSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy5jaGFuZ2UoaGFuZGxlRmlsZVNlbGVjdCk7CiAgICAgICAgfQogICAgfTsKfSk7CgphcHAuZGlyZWN0aXZlKCdlbGV2YWxpZGF0aW9uJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7CiAgICAgICAgICAgIGVsbS5iaW5kKCdmb2N1c291dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghJChlbG0pLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgJChlbG0pLnJlbW92ZUNsYXNzKCduZy12YWxpZCcpOwogICAgICAgICAgICAgICAgICAgICQoZWxtKS5yZW1vdmVDbGFzcygnbmctdmFsaWQtZWxldmFsaWRhdGlvbicpOwogICAgICAgICAgICAgICAgICAgICQoZWxtKS5hZGRDbGFzcygnbmctaW52YWxpZCcpOwogICAgICAgICAgICAgICAgICAgICQoZWxtKS5hZGRDbGFzcygnbmctaW52YWxpZC1lbGV2YWxpZGF0aW9uJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgoJChlbG0pLnZhbCgpLmNoYXJBdCgkKGVsbSkudmFsKCkubGVuZ3RoIC0gMSkgPT0gJyAnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkudmFsKCQoZWxtKS52YWwoKS5zdWJzdHJpbmcoMCwgJChlbG0pLnZhbCgpLmxlbmd0aCAtIDEpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjdHJsLiRwYXJzZXJzLnVuc2hpZnQoZnVuY3Rpb24gKHZpZXdWYWx1ZSkgewogICAgICAgICAgICAgICAgZWxtLmJpbmQoJ2JsdXInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsbS5jb250ZXh0LnRhZ05hbWUgIT0gJ1NFTEVDVCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZpZXdWYWx1ZShlbG0uaHRtbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gbW9kZWwgLT4gdmlldwogICAgICAgICAgICAgICAgY3RybC4kcmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChlbG0uY29udGV4dC50YWdOYW1lICE9ICdTRUxFQ1QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5odG1sKGN0cmwuJHZpZXdWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBsb2FkIGluaXQgdmFsdWUgZnJvbSBET00KICAgICAgICAgICAgICAgIGlmIChlbG0uY29udGV4dC50YWdOYW1lICE9ICdTRUxFQ1QnKSB7CiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKGVsbS5odG1sKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciB0eXBlX2VsZW1lbnQgPSBlbG0uY29udGV4dC5hdHRyaWJ1dGVzWydkYXRhLXR5cGUnXS52YWx1ZTsKICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZV9lbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbG9naW4nOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTE9HSU5fUkVHRVhQLnRlc3Qodmlld1ZhbHVlKSAmJiB2aWV3VmFsdWUgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcygnbG9naW4nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LmxvZ2luJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbG0uY29udGV4dC52YWx1ZSA9IHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmFtZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChOQU1FX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVRpdGxlID0gZWxtLmNvbnRleHQuYXR0cmlidXRlc1snZGF0YS10eXBlLXRpdGxlJ10udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcyhkYXRhVGl0bGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuJyArIGRhdGFUaXRsZSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbG0uY29udGV4dC52YWx1ZSA9IHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3VybmFtZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTVVJOQU1FX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVRpdGxlID0gZWxtLmNvbnRleHQuYXR0cmlidXRlc1snZGF0YS10eXBlLXRpdGxlJ10udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcyhkYXRhVGl0bGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuJyArIGRhdGFUaXRsZSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbG0uY29udGV4dC52YWx1ZSA9IHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbG9naW5fbnVtYmVyJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChMT0dJTl9OVU1CRVJfUkVHRVhQLnRlc3Qodmlld1ZhbHVlKSAmJiB2aWV3VmFsdWUgIT0gJycpIHx8IChFTUFJTF9SRUdFWFAudGVzdCh2aWV3VmFsdWUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKCdsb2dpbl9udW1iZXInKSB8fCAkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKCdsb2dpbicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQubG9naW5fbnVtYmVyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQubG9naW4nKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5jb250ZXh0LnZhbHVlID0gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdzaXRlJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNJVEVfUkVHRVhQLnRlc3Qodmlld1ZhbHVlKSB8fCBGVUxMX1VSTF9TSVRFX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcygnc2l0ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuc2l0ZScpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdzaXRlX3J1JzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNJVEVfUkVHRVhQX1JVLnRlc3Qodmlld1ZhbHVlKSB8fCBGVUxMX1VSTF9TSVRFX1JFR0VYUF9SVS50ZXN0KHZpZXdWYWx1ZSkgfHwgRlVMTF9VUkxfU0lURV9SRUdFWFBfVEVTVC50ZXN0KHZpZXdWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcygnc2l0ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuc2l0ZScpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2l0ZV9ydV9lbnRlcic6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTSVRFX1JFR0VYUF9SVS50ZXN0KHZpZXdWYWx1ZSkgfHwgRlVMTF9VUkxfU0lURV9SRUdFWFBfUlUudGVzdCh2aWV3VmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoJ3NpdGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LnNpdGUnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5zaXRlX3J1X2VudGVyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZXJyb3Jfc2l0ZV9pbnB1dCcpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAncGhvbmUnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHZpZXdWYWx1ZSAhPSAnJyAmJiB2aWV3VmFsdWUubGVuZ3RoID09IDE4KSB8fCAoZWxtLmNvbnRleHQudmFsdWUubGVuZ3RoID09IDE4KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKCdwaG9uZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQucGhvbmUnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5jb250ZXh0LnZhbHVlID0gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xvZ2luQ3lyaWxsaWMnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTkFNRV9DWVJJTExJQ19SRUdFWFAudGVzdCh2aWV3VmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUaXRsZSA9IGVsbS5jb250ZXh0LmF0dHJpYnV0ZXNbJ2RhdGEtdHlwZS10aXRsZSddLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoZGF0YVRpdGxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LicgKyBkYXRhVGl0bGUpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxtLmNvbnRleHQudmFsdWUgPSB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Bhc3N3b3JkJzoKICAgICAgICAgICAgICAgICAgICAgICAgdmlld1ZhbHVlID0gdmlld1ZhbHVlLnJlcGxhY2UoL1xzL2csICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHZpZXdWYWx1ZS5jaGFyQXQodmlld1ZhbHVlLmxlbmd0aCAtIDEpID09ICcgJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld1ZhbHVlID0gdmlld1ZhbHVlLnN1YnN0cmluZygwLCB2aWV3VmFsdWUubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJChlbG0pLnZhbCh2aWV3VmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcuZXJyb3JzX2Jsb2NrJykuZW1wdHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmJsb2NrX3Nob3dfZXJyb3JfcGFzc3dvcmQnKS5maW5kKCcucGFzc3dvcmRfZXJyb3JfYWxlcnQnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFBBU1NXT1JEX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkgJiYgKCFBTExfUlVfQ0hBUi50ZXN0KHZpZXdWYWx1ZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUaXRsZSA9ICQoZWxtKS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKGRhdGFUaXRsZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudmFsaWRfZWxlbWVudC4nICsgZGF0YVRpdGxlKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW1haWwnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoRU1BSUxfUkVHRVhQLnRlc3Qodmlld1ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKCdlbWFpbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuZW1haWwnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW1haWxfdmFsaWQnOgogICAgICAgICAgICAgICAgICAgICAgICB2aWV3VmFsdWUgPSAkKGVsbSkudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChFTUFJTF9SRUdFWFAudGVzdCh2aWV3VmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/Qv9C+0LvQtSDQvdC1INGA0LXQsNCz0LjRgNC+0LLQsNC70L4g0L3QsCDQsNCy0YLQvtC30LDQv9C+0LvQvdC10L3QuNC1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsbSkucmVtb3ZlQ2xhc3MoJ25nLWludmFsaWQtZWxldmFsaWRhdGlvbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoJ2VtYWlsJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudmFsaWRfZWxlbWVudC5lbWFpbCcpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3QnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChlbG0pLnZhbCgpICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUaXRsZSA9IGVsbS5jb250ZXh0LmF0dHJpYnV0ZXNbJ2RhdGEtdHlwZS10aXRsZSddLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoZGF0YVRpdGxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LicgKyBkYXRhVGl0bGUpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdub251bGwnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlld1ZhbHVlLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoJ25vbnVsbCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQubm9udWxsJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodmlld1ZhbHVlLmNoYXJBdCh2aWV3VmFsdWUubGVuZ3RoIC0gMSkgPT0gJyAnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld1ZhbHVlID0gdmlld1ZhbHVlLnN1YnN0cmluZygwLCB2aWV3VmFsdWUubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXdWYWx1ZS5zcGxpdCgnJykubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhVGl0bGUgPSBlbG0uY29udGV4dC5hdHRyaWJ1dGVzWydkYXRhLXR5cGUtdGl0bGUnXS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKGRhdGFUaXRsZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudmFsaWRfZWxlbWVudC4nICsgZGF0YVRpdGxlKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3lyaWxsaWMnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHZpZXdWYWx1ZS5zcGxpdCgnJykubGVuZ3RoID4gMSkgJiYgKENZUklMTElDX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUaXRsZSA9IGVsbS5jb250ZXh0LmF0dHJpYnV0ZXNbJ2RhdGEtdHlwZS10aXRsZSddLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoZGF0YVRpdGxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LicgKyBkYXRhVGl0bGUpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdjeXJpbGxpY19kdW8nOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHZpZXdWYWx1ZS5zcGxpdCgnJykubGVuZ3RoID4gMSkgJiYgKChDWVJJTExJQ19SRUdFWFAudGVzdCh2aWV3VmFsdWUpKSB8fCAoQ1lSSUxMSUNfRFVPX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhVGl0bGUgPSBlbG0uY29udGV4dC5hdHRyaWJ1dGVzWydkYXRhLXR5cGUtdGl0bGUnXS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcudmFsaWRfZWxlbWVudCcpLmhhc0NsYXNzKGRhdGFUaXRsZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudmFsaWRfZWxlbWVudC4nICsgZGF0YVRpdGxlKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZmlvJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2aWV3VmFsdWUuc3BsaXQoJyAnKS5sZW5ndGggPiAxKSAmJiAoRklPX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUaXRsZSA9IGVsbS5jb250ZXh0LmF0dHJpYnV0ZXNbJ2RhdGEtdHlwZS10aXRsZSddLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoZGF0YVRpdGxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LicgKyBkYXRhVGl0bGUpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdjb2xfcGVvcGxlJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2aWV3VmFsdWUgIT0gMCkgJiYgKHZpZXdWYWx1ZS5zcGxpdCgnJykubGVuZ3RoID49IDEpICYmIChOVU1CRVJfUkVHRVhQLnRlc3Qodmlld1ZhbHVlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVRpdGxlID0gZWxtLmNvbnRleHQuYXR0cmlidXRlc1snZGF0YS10eXBlLXRpdGxlJ10udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcyhkYXRhVGl0bGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuJyArIGRhdGFUaXRsZSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N1bSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmlld1ZhbHVlICE9IDApICYmIChOVU1CRVJfUkVHRVhQLnRlc3Qodmlld1ZhbHVlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVRpdGxlID0gZWxtLmNvbnRleHQuYXR0cmlidXRlc1snZGF0YS10eXBlLXRpdGxlJ10udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcyhkYXRhVGl0bGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuJyArIGRhdGFUaXRsZSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0ZXAnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlld1ZhbHVlLnNwbGl0KCcnKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZWxldmFsaWRhdGlvbicsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFUaXRsZSA9IGVsbS5jb250ZXh0LmF0dHJpYnV0ZXNbJ2RhdGEtdHlwZS10aXRsZSddLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy52YWxpZF9lbGVtZW50JykuaGFzQ2xhc3MoZGF0YVRpdGxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LicgKyBkYXRhVGl0bGUpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdyYWRpbyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2aWV3VmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVRpdGxlID0gZWxtLmNvbnRleHQuYXR0cmlidXRlc1snZGF0YS10eXBlLXRpdGxlJ10udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcyhkYXRhVGl0bGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnZhbGlkX2VsZW1lbnQuJyArIGRhdGFUaXRsZSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlICdiaXJ0aGRheSc6CiAgICAgICAgICAgICAgICAgICAgaWYgKEJJUlRIREFZX1JFR0VYUC50ZXN0KHZpZXdWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdlbGV2YWxpZGF0aW9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVRpdGxlID0gZWxtLmNvbnRleHQuYXR0cmlidXRlc1snZGF0YS10eXBlLXRpdGxlJ10udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLnZhbGlkX2VsZW1lbnQnKS5oYXNDbGFzcyhkYXRhVGl0bGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJy52YWxpZF9lbGVtZW50LicgKyBkYXRhVGl0bGUpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2VsZXZhbGlkYXRpb24nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKfSk7CgoKLyoqCiAqIEZpbHRlcnMKICovCgphcHAuZmlsdGVyKCd0cmFuc2xhdGUnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkY29uZmlnKSB7CiAgICByZXR1cm4gZnVuY3Rpb24obGFiZWxDb2RlKSB7CiAgICAgICAgcmV0dXJuICRjb25maWcudHJhbnNsYXRpb25bbGFiZWxDb2RlLnNwbGl0KCcuJylbMF1dW2xhYmVsQ29kZS5zcGxpdCgnLicpWzFdXTsKICAgIH0KfSk7CgphcHAuZmlsdGVyKCdzb3J0X3N0ZXBfcGFydGljaXBhbnRHcm91cCcsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoaXRlbXMpIHsKICAgICAgICB2YXIgZmlsdGVyZWQgPSBbXTsKICAgICAgICBmb3IgKHZhciBpIGluIGl0ZW1zKSB7CiAgICAgICAgICAgIGlmIChpdGVtc1tpXS5wYXJ0aWNpcGFudEdyb3VwcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJlZC5wdXNoKGl0ZW1zW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmlsdGVyZWQ7CiAgICB9Owp9KTsKCmFwcC5maWx0ZXIoJ3NvcnRfc3RlcF9ub19wYXJ0aWNpcGFudEdyb3VwJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtcykgewogICAgICAgIHZhciBmaWx0ZXJlZCA9IFtdOwogICAgICAgIGZvciAodmFyIGkgaW4gaXRlbXMpIHsKICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLnBhcnRpY2lwYW50R3JvdXBzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpbHRlcmVkLnB1c2goaXRlbXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmaWx0ZXJlZDsKICAgIH07Cn0pOwoKYXBwLmZpbHRlcignQWxsWWVhcicsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZVN0cmluZykgewogICAgICAgIHZhciBkYXkgPSBwYXJzZUludChkYXRlU3RyaW5nLnN1YnN0cmluZygwLCAyKSk7CiAgICAgICAgdmFyIG1vbnRoID0gcGFyc2VJbnQoZGF0ZVN0cmluZy5zdWJzdHJpbmcoMywgNSkpOwogICAgICAgIHZhciB5ZWFyID0gcGFyc2VJbnQoZGF0ZVN0cmluZy5zdWJzdHJpbmcoNiwgMTApKTsKCiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgYmlydGhEYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSk7CiAgICAgICAgdmFyIGFnZSA9IHRvZGF5LmdldEZ1bGxZZWFyKCkgLSBiaXJ0aERhdGUuZ2V0RnVsbFllYXIoKTsKICAgICAgICB2YXIgbSA9IHRvZGF5LmdldE1vbnRoKCkgLSBiaXJ0aERhdGUuZ2V0TW9udGgoKTsKICAgICAgICBpZiAobSA8IDAgfHwgKG0gPT09IDAgJiYgdG9kYXkuZ2V0RGF0ZSgpIDwgYmlydGhEYXRlLmdldERhdGUoKSkpIHsKICAgICAgICAgICAgYWdlLS07CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZ2U7CiAgICB9Owp9KTsKCmFwcC5maWx0ZXIoJ2NyZWF0ZURhdGUnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGVTdHJpbmcpIHsKICAgICAgICBpZiAoZGF0ZSAhPSBudWxsKQogICAgICAgICAgICB2YXIgZGF0ZSA9IGRhdGVTdHJpbmcuc3Vic3RyKDAsIDEwKS5yZXBsYWNlKC8tL2csICcuJyk7CiAgICAgICAgcmV0dXJuIGRhdGU7CiAgICB9Cn0pOwoKYXBwLmZpbHRlcignaW5jb21lJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRlU3RyaW5nKSB7CiAgICAgICAgaWYgKGRhdGVTdHJpbmcgPT0gNTUwMDApIHsKICAgICAgICAgICAgZGF0ZVN0cmluZyA9ICc1MCAwMDArJwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGVTdHJpbmcgPSBmb3JtYXRfcHJpY2UoZGF0ZVN0cmluZyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkYXRlU3RyaW5nOwogICAgfQp9KTsKCmFwcC5maWx0ZXIoJ3N0ZXBzJywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRlKSB7CiAgICAgICAgdmFyIHN0ZXBEZXNjcmlwdGlvbiA9ICcnOwogICAgICAgIGZvciAodmFyIGkgaW4gZGF0ZS5zdGVwcykgewogICAgICAgICAgICBzdGVwRGVzY3JpcHRpb24gKz0gJzxwPicgKyBkYXRlLnN0ZXBzW2ldLnN0ZXBEZXRhaWxzICsgJzwvcD4nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RlcERlc2NyaXB0aW9uOwogICAgfQp9KTsKCmFwcC5maWx0ZXIoJ29yZGVyT2JqZWN0QnknLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGlucHV0LCBhdHRyaWJ1dGUpIHsKICAgICAgICBpZiAoIWFuZ3VsYXIuaXNPYmplY3QoaW5wdXQpKSByZXR1cm4gaW5wdXQ7CgogICAgICAgIHZhciBhcnJheSA9IFtdOwogICAgICAgIGZvciAodmFyIG9iamVjdEtleSBpbiBpbnB1dCkgewogICAgICAgICAgICBhcnJheS5wdXNoKGlucHV0W29iamVjdEtleV0pOwogICAgICAgIH0KCiAgICAgICAgYXJyYXkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICBhID0gcGFyc2VJbnQoYVthdHRyaWJ1dGVdKTsKICAgICAgICAgICAgYiA9IHBhcnNlSW50KGJbYXR0cmlidXRlXSk7CiAgICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gYXJyYXk7CiAgICB9Cn0pOwoKYXBwLmZpbHRlcignc2Vjb25kc1RvTWludXRlcycsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICBkID0gTnVtYmVyKGlucHV0KTsKICAgICAgICB2YXIgaG91cnMgPSBNYXRoLmZsb29yKGQgLyAzNjAwKTsKICAgICAgICB2YXIgbWludXRlcyA9IE1hdGguZmxvb3IoZCAlIDM2MDAgLyA2MCkgKyBob3VycyAqIDYwOwogICAgICAgIHZhciBzZWNvbmRzID0gTWF0aC5mbG9vcihkICUgMzYwMCAlIDYwKTsKCiAgICAgICAgcmV0dXJuIChtaW51dGVzIDwgMTAgPyAiMCIgKyBtaW51dGVzIDogbWludXRlcykgKyAiOiIgKyAoc2Vjb25kcyAgPCAxMCA/ICIwIiArIHNlY29uZHMgOiBzZWNvbmRzKTsKICAgIH0KfSk7Cg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="80862140" offset="0" length="756" />
        <PacketInfo time="80862156" offset="756" length="16355" />
        <PacketInfo time="80862156" offset="17111" length="16355" />
        <PacketInfo time="80862156" offset="33466" length="16355" />
        <PacketInfo time="80862156" offset="49821" length="16355" />
        <PacketInfo time="80862156" offset="66176" length="16355" />
        <PacketInfo time="80862156" offset="82531" length="5703" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>